(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):(global=typeof globalThis!=="undefined"?globalThis:global||self,factory(global["base64-arraybuffer"]={}))})(this,function(exports){"use strict";var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var lookup=typeof Uint8Array==="undefined"?[]:new Uint8Array(256);for(var i=0;i<chars.length;i++){lookup[chars.charCodeAt(i)]=i}var encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64="";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];base64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+"="}else if(len%3===1){base64=base64.substring(0,base64.length-2)+"=="}return base64};var decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]==="="){bufferLength--;if(base64[base64.length-2]==="="){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=lookup[base64.charCodeAt(i)];encoded2=lookup[base64.charCodeAt(i+1)];encoded3=lookup[base64.charCodeAt(i+2)];encoded4=lookup[base64.charCodeAt(i+3)];bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer};exports.decode=decode;exports.encode=encode;Object.defineProperty(exports,"__esModule",{value:true})})},{}],2:[function(require,module,exports){exports.Emitter=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks["$"+event]=this._callbacks["$"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks["$"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks["$"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}if(callbacks.length===0){delete this._callbacks["$"+event]}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=new Array(arguments.length-1),callbacks=this._callbacks["$"+event];for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.emitReserved=Emitter.prototype.emit;Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks["$"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],3:[function(require,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],4:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var validLen=b64.indexOf("=");if(validLen===-1)validLen=len;var placeHoldersLen=validLen===len?0:4-validLen%4;return[validLen,placeHoldersLen]}function byteLength(b64){var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function _byteLength(b64,validLen,placeHoldersLen){return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function toByteArray(b64){var tmp;var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];var arr=new Arr(_byteLength(b64,validLen,placeHoldersLen));var curByte=0;var len=placeHoldersLen>0?validLen-4:validLen;var i;for(i=0;i<len;i+=4){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[curByte++]=tmp>>16&255;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}if(placeHoldersLen===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[curByte++]=tmp&255}if(placeHoldersLen===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(uint8[i+2]&255);output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"=")}return parts.join("")}},{}],5:[function(require,module,exports){(function(Buffer){(function(){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH;Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport();if(!Buffer.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42}catch(e){return false}}Object.defineProperty(Buffer.prototype,"parent",{enumerable:true,get:function(){if(!Buffer.isBuffer(this))return undefined;return this.buffer}});Object.defineProperty(Buffer.prototype,"offset",{enumerable:true,get:function(){if(!Buffer.isBuffer(this))return undefined;return this.byteOffset}});function createBuffer(length){if(length>K_MAX_LENGTH){throw new RangeError('The value "'+length+'" is invalid for option "size"')}var buf=new Uint8Array(length);buf.__proto__=Buffer.prototype;return buf}function Buffer(arg,encodingOrOffset,length){if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new TypeError('The "string" argument must be of type string. Received type number')}return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}if(typeof Symbol!=="undefined"&&Symbol.species!=null&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}Buffer.poolSize=8192;function from(value,encodingOrOffset,length){if(typeof value==="string"){return fromString(value,encodingOrOffset)}if(ArrayBuffer.isView(value)){return fromArrayLike(value)}if(value==null){throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof value)}if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer)){return fromArrayBuffer(value,encodingOrOffset,length)}if(typeof value==="number"){throw new TypeError('The "value" argument must not be of type number. Received type number')}var valueOf=value.valueOf&&value.valueOf();if(valueOf!=null&&valueOf!==value){return Buffer.from(valueOf,encodingOrOffset,length)}var b=fromObject(value);if(b)return b;if(typeof Symbol!=="undefined"&&Symbol.toPrimitive!=null&&typeof value[Symbol.toPrimitive]==="function"){return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof value)}Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)};Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be of type number')}else if(size<0){throw new RangeError('The value "'+size+'" is invalid for option "size"')}}function alloc(size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill)}return createBuffer(size)}Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)};function allocUnsafe(size){assertSize(size);return createBuffer(size<0?0:checked(size)|0)}Buffer.allocUnsafe=function(size){return allocUnsafe(size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromString(string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}var length=byteLength(string,encoding)|0;var buf=createBuffer(length);var actual=buf.write(string,encoding);if(actual!==length){buf=buf.slice(0,actual)}return buf}function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0;var buf=createBuffer(length);for(var i=0;i<length;i+=1){buf[i]=array[i]&255}return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError('"offset" is outside of buffer bounds')}if(array.byteLength<byteOffset+(length||0)){throw new RangeError('"length" is outside of buffer bounds')}var buf;if(byteOffset===undefined&&length===undefined){buf=new Uint8Array(array)}else if(length===undefined){buf=new Uint8Array(array,byteOffset)}else{buf=new Uint8Array(array,byteOffset,length)}buf.__proto__=Buffer.prototype;return buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;var buf=createBuffer(len);if(buf.length===0){return buf}obj.copy(buf,0,0,len);return buf}if(obj.length!==undefined){if(typeof obj.length!=="number"||numberIsNaN(obj.length)){return createBuffer(0)}return fromArrayLike(obj)}if(obj.type==="Buffer"&&Array.isArray(obj.data)){return fromArrayLike(obj.data)}}function checked(length){if(length>=K_MAX_LENGTH){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+K_MAX_LENGTH.toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===true&&b!==Buffer.prototype};Buffer.compare=function compare(a,b){if(isInstance(a,Uint8Array))a=Buffer.from(a,a.offset,a.byteLength);if(isInstance(b,Uint8Array))b=Buffer.from(b,b.offset,b.byteLength);if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array')}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!Array.isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)){buf=Buffer.from(buf)}if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. '+"Received type "+typeof string)}var len=string.length;var mustMatch=arguments.length>2&&arguments[2]===true;if(!mustMatch&&len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase){return mustMatch?-1:utf8ToBytes(string).length}encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.toLocaleString=Buffer.prototype.toString;Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim();if(this.length>max)str+=" ... ";return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)){target=Buffer.from(target,target.offset,target.byteLength)}if(!Buffer.isBuffer(target)){throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. '+"Received type "+typeof target)}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(numberIsNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset>>>0;if(isFinite(length)){length=length>>>0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);this[offset]=value&255;return offset+1};Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255;return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24;return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,4,34028234663852886e22,-34028234663852886e22)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,8,17976931348623157e292,-17976931348623157e292)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;if(this===target&&typeof Uint8Array.prototype.copyWithin==="function"){this.copyWithin(targetStart,start,end)}else if(this===target&&start<targetStart&&targetStart<end){for(var i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}if(val.length===1){var code=val.charCodeAt(0);if(encoding==="utf8"&&code<128||encoding==="latin1"){val=code}}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding);var len=bytes.length;if(len===0){throw new TypeError('The value "'+val+'" is invalid for argument "value"')}for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function base64clean(str){str=str.split("=")[0];str=str.trim().replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isInstance(obj,type){return obj instanceof type||obj!=null&&obj.constructor!=null&&obj.constructor.name!=null&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!==obj}}).call(this)}).call(this,require("buffer").Buffer)},{"base64-js":4,buffer:5,ieee754:25}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=(()=>{if(typeof self!=="undefined"){return self}else if(typeof window!=="undefined"){return window}else{return Function("return this")()}})()},{}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.installTimerFunctions=exports.transports=exports.Transport=exports.protocol=exports.Socket=void 0;const socket_js_1=require("./socket.js");Object.defineProperty(exports,"Socket",{enumerable:true,get:function(){return socket_js_1.Socket}});exports.protocol=socket_js_1.Socket.protocol;var transport_js_1=require("./transport.js");Object.defineProperty(exports,"Transport",{enumerable:true,get:function(){return transport_js_1.Transport}});var index_js_1=require("./transports/index.js");Object.defineProperty(exports,"transports",{enumerable:true,get:function(){return index_js_1.transports}});var util_js_1=require("./util.js");Object.defineProperty(exports,"installTimerFunctions",{enumerable:true,get:function(){return util_js_1.installTimerFunctions}})},{"./socket.js":8,"./transport.js":9,"./transports/index.js":10,"./util.js":16}],8:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.Socket=void 0;const index_js_1=require("./transports/index.js");const util_js_1=require("./util.js");const parseqs_1=__importDefault(require("parseqs"));const parseuri_1=__importDefault(require("parseuri"));const debug_1=__importDefault(require("debug"));const component_emitter_1=require("@socket.io/component-emitter");const engine_io_parser_1=require("engine.io-parser");const debug=(0,debug_1.default)("engine.io-client:socket");class Socket extends component_emitter_1.Emitter{constructor(uri,opts={}){super();if(uri&&"object"===typeof uri){opts=uri;uri=null}if(uri){uri=(0,parseuri_1.default)(uri);opts.hostname=uri.host;opts.secure=uri.protocol==="https"||uri.protocol==="wss";opts.port=uri.port;if(uri.query)opts.query=uri.query}else if(opts.host){opts.hostname=(0,parseuri_1.default)(opts.host).host}(0,util_js_1.installTimerFunctions)(this,opts);this.secure=null!=opts.secure?opts.secure:typeof location!=="undefined"&&"https:"===location.protocol;if(opts.hostname&&!opts.port){opts.port=this.secure?"443":"80"}this.hostname=opts.hostname||(typeof location!=="undefined"?location.hostname:"localhost");this.port=opts.port||(typeof location!=="undefined"&&location.port?location.port:this.secure?"443":"80");this.transports=opts.transports||["polling","websocket"];this.readyState="";this.writeBuffer=[];this.prevBufferLen=0;this.opts=Object.assign({path:"/engine.io",agent:false,withCredentials:false,upgrade:true,timestampParam:"t",rememberUpgrade:false,rejectUnauthorized:true,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:true},opts);this.opts.path=this.opts.path.replace(/\/$/,"")+"/";if(typeof this.opts.query==="string"){this.opts.query=parseqs_1.default.decode(this.opts.query)}this.id=null;this.upgrades=null;this.pingInterval=null;this.pingTimeout=null;this.pingTimeoutTimer=null;if(typeof addEventListener==="function"){if(this.opts.closeOnBeforeunload){addEventListener("beforeunload",()=>{if(this.transport){this.transport.removeAllListeners();this.transport.close()}},false)}if(this.hostname!=="localhost"){this.offlineEventListener=()=>{this.onClose("transport close")};addEventListener("offline",this.offlineEventListener,false)}}this.open()}createTransport(name){debug('creating transport "%s"',name);const query=clone(this.opts.query);query.EIO=engine_io_parser_1.protocol;query.transport=name;if(this.id)query.sid=this.id;const opts=Object.assign({},this.opts.transportOptions[name],this.opts,{query:query,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});debug("options: %j",opts);return new index_js_1.transports[name](opts)}open(){let transport;if(this.opts.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1){transport="websocket"}else if(0===this.transports.length){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else{transport=this.transports[0]}this.readyState="opening";try{transport=this.createTransport(transport)}catch(e){debug("error while creating transport: %s",e);this.transports.shift();this.open();return}transport.open();this.setTransport(transport)}setTransport(transport){debug("setting transport %s",transport.name);if(this.transport){debug("clearing existing transport %s",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",()=>{this.onClose("transport close")})}probe(name){debug('probing transport "%s"',name);let transport=this.createTransport(name);let failed=false;Socket.priorWebsocketSuccess=false;const onTransportOpen=()=>{if(failed)return;debug('probe transport "%s" opened',name);transport.send([{type:"ping",data:"probe"}]);transport.once("packet",msg=>{if(failed)return;if("pong"===msg.type&&"probe"===msg.data){debug('probe transport "%s" pong',name);this.upgrading=true;this.emitReserved("upgrading",transport);if(!transport)return;Socket.priorWebsocketSuccess="websocket"===transport.name;debug('pausing current transport "%s"',this.transport.name);this.transport.pause(()=>{if(failed)return;if("closed"===this.readyState)return;debug("changing transport and sending upgrade packet");cleanup();this.setTransport(transport);transport.send([{type:"upgrade"}]);this.emitReserved("upgrade",transport);transport=null;this.upgrading=false;this.flush()})}else{debug('probe transport "%s" failed',name);const err=new Error("probe error");err.transport=transport.name;this.emitReserved("upgradeError",err)}})};function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}const onerror=err=>{const error=new Error("probe error: "+err);error.transport=transport.name;freezeTransport();debug('probe transport "%s" failed because of error: %s',name,err);this.emitReserved("upgradeError",error)};function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){if(transport&&to.name!==transport.name){debug('"%s" works - aborting "%s"',to.name,transport.name);freezeTransport()}}const cleanup=()=>{transport.removeListener("open",onTransportOpen);transport.removeListener("error",onerror);transport.removeListener("close",onTransportClose);this.off("close",onclose);this.off("upgrading",onupgrade)};transport.once("open",onTransportOpen);transport.once("error",onerror);transport.once("close",onTransportClose);this.once("close",onclose);this.once("upgrading",onupgrade);transport.open()}onOpen(){debug("socket open");this.readyState="open";Socket.priorWebsocketSuccess="websocket"===this.transport.name;this.emitReserved("open");this.flush();if("open"===this.readyState&&this.opts.upgrade&&this.transport.pause){debug("starting upgrade probes");let i=0;const l=this.upgrades.length;for(;i<l;i++){this.probe(this.upgrades[i])}}}onPacket(packet){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){debug('socket receive: type "%s", data "%s"',packet.type,packet.data);this.emitReserved("packet",packet);this.emitReserved("heartbeat");switch(packet.type){case"open":this.onHandshake(JSON.parse(packet.data));break;case"ping":this.resetPingTimeout();this.sendPacket("pong");this.emitReserved("ping");this.emitReserved("pong");break;case"error":const err=new Error("server error");err.code=packet.data;this.onError(err);break;case"message":this.emitReserved("data",packet.data);this.emitReserved("message",packet.data);break}}else{debug('packet received with socket readyState "%s"',this.readyState)}}onHandshake(data){this.emitReserved("handshake",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if("closed"===this.readyState)return;this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer);this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout);if(this.opts.autoUnref){this.pingTimeoutTimer.unref()}}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emitReserved("drain")}else{this.flush()}}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug("flushing %d packets in socket",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emitReserved("flush")}}write(msg,options,fn){this.sendPacket("message",msg,options,fn);return this}send(msg,options,fn){this.sendPacket("message",msg,options,fn);return this}sendPacket(type,data,options,fn){if("function"===typeof data){fn=data;data=undefined}if("function"===typeof options){fn=options;options=null}if("closing"===this.readyState||"closed"===this.readyState){return}options=options||{};options.compress=false!==options.compress;const packet={type:type,data:data,options:options};this.emitReserved("packetCreate",packet);this.writeBuffer.push(packet);if(fn)this.once("flush",fn);this.flush()}close(){const close=()=>{this.onClose("forced close");debug("socket closing - telling transport to close");this.transport.close()};const cleanupAndClose=()=>{this.off("upgrade",cleanupAndClose);this.off("upgradeError",cleanupAndClose);close()};const waitForUpgrade=()=>{this.once("upgrade",cleanupAndClose);this.once("upgradeError",cleanupAndClose)};if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";if(this.writeBuffer.length){this.once("drain",()=>{if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}return this}onError(err){debug("socket error %j",err);Socket.priorWebsocketSuccess=false;this.emitReserved("error",err);this.onClose("transport error",err)}onClose(reason,desc){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){debug('socket close with reason: "%s"',reason);this.clearTimeoutFn(this.pingTimeoutTimer);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();if(typeof removeEventListener==="function"){removeEventListener("offline",this.offlineEventListener,false)}this.readyState="closed";this.id=null;this.emitReserved("close",reason,desc);this.writeBuffer=[];this.prevBufferLen=0}}filterUpgrades(upgrades){const filteredUpgrades=[];let i=0;const j=upgrades.length;for(;i<j;i++){if(~this.transports.indexOf(upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}exports.Socket=Socket;Socket.protocol=engine_io_parser_1.protocol;function clone(obj){const o={};for(let i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}},{"./transports/index.js":10,"./util.js":16,"@socket.io/component-emitter":2,debug:17,"engine.io-parser":23,parseqs:26,parseuri:27}],9:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.Transport=void 0;const engine_io_parser_1=require("engine.io-parser");const component_emitter_1=require("@socket.io/component-emitter");const util_js_1=require("./util.js");const debug_1=__importDefault(require("debug"));const debug=(0,debug_1.default)("engine.io-client:transport");class Transport extends component_emitter_1.Emitter{constructor(opts){super();this.writable=false;(0,util_js_1.installTimerFunctions)(this,opts);this.opts=opts;this.query=opts.query;this.readyState="";this.socket=opts.socket}onError(msg,desc){const err=new Error(msg);err.type="TransportError";err.description=desc;super.emit("error",err);return this}open(){if("closed"===this.readyState||""===this.readyState){this.readyState="opening";this.doOpen()}return this}close(){if("opening"===this.readyState||"open"===this.readyState){this.doClose();this.onClose()}return this}send(packets){if("open"===this.readyState){this.write(packets)}else{debug("transport is not open, discarding packets")}}onOpen(){this.readyState="open";this.writable=true;super.emit("open")}onData(data){const packet=(0,engine_io_parser_1.decodePacket)(data,this.socket.binaryType);this.onPacket(packet)}onPacket(packet){super.emit("packet",packet)}onClose(){this.readyState="closed";super.emit("close")}}exports.Transport=Transport},{"./util.js":16,"@socket.io/component-emitter":2,debug:17,"engine.io-parser":23}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.transports=void 0;const polling_xhr_js_1=require("./polling-xhr.js");const websocket_js_1=require("./websocket.js");exports.transports={websocket:websocket_js_1.WS,polling:polling_xhr_js_1.XHR}},{"./polling-xhr.js":11,"./websocket.js":14}],11:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.Request=exports.XHR=void 0;const xmlhttprequest_js_1=__importDefault(require("./xmlhttprequest.js"));const debug_1=__importDefault(require("debug"));const globalThis_js_1=__importDefault(require("../globalThis.js"));const util_js_1=require("../util.js");const component_emitter_1=require("@socket.io/component-emitter");const polling_js_1=require("./polling.js");const debug=(0,debug_1.default)("engine.io-client:polling-xhr");function empty(){}const hasXHR2=function(){const xhr=new xmlhttprequest_js_1.default({xdomain:false});return null!=xhr.responseType}();class XHR extends polling_js_1.Polling{constructor(opts){super(opts);if(typeof location!=="undefined"){const isSSL="https:"===location.protocol;let port=location.port;if(!port){port=isSSL?"443":"80"}this.xd=typeof location!=="undefined"&&opts.hostname!==location.hostname||port!==opts.port;this.xs=opts.secure!==isSSL}const forceBase64=opts&&opts.forceBase64;this.supportsBinary=hasXHR2&&!forceBase64}request(opts={}){Object.assign(opts,{xd:this.xd,xs:this.xs},this.opts);return new Request(this.uri(),opts)}doWrite(data,fn){const req=this.request({method:"POST",data:data});req.on("success",fn);req.on("error",err=>{this.onError("xhr post error",err)})}doPoll(){debug("xhr poll");const req=this.request();req.on("data",this.onData.bind(this));req.on("error",err=>{this.onError("xhr poll error",err)});this.pollXhr=req}}exports.XHR=XHR;class Request extends component_emitter_1.Emitter{constructor(uri,opts){super();(0,util_js_1.installTimerFunctions)(this,opts);this.opts=opts;this.method=opts.method||"GET";this.uri=uri;this.async=false!==opts.async;this.data=undefined!==opts.data?opts.data:null;this.create()}create(){const opts=(0,util_js_1.pick)(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");opts.xdomain=!!this.opts.xd;opts.xscheme=!!this.opts.xs;const xhr=this.xhr=new xmlhttprequest_js_1.default(opts);try{debug("xhr open %s: %s",this.method,this.uri);xhr.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){xhr.setDisableHeaderCheck&&xhr.setDisableHeaderCheck(true);for(let i in this.opts.extraHeaders){if(this.opts.extraHeaders.hasOwnProperty(i)){xhr.setRequestHeader(i,this.opts.extraHeaders[i])}}}}catch(e){}if("POST"===this.method){try{xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}}try{xhr.setRequestHeader("Accept","*/*")}catch(e){}if("withCredentials"in xhr){xhr.withCredentials=this.opts.withCredentials}if(this.opts.requestTimeout){xhr.timeout=this.opts.requestTimeout}xhr.onreadystatechange=()=>{if(4!==xhr.readyState)return;if(200===xhr.status||1223===xhr.status){this.onLoad()}else{this.setTimeoutFn(()=>{this.onError(typeof xhr.status==="number"?xhr.status:0)},0)}};debug("xhr data %s",this.data);xhr.send(this.data)}catch(e){this.setTimeoutFn(()=>{this.onError(e)},0);return}if(typeof document!=="undefined"){this.index=Request.requestsCount++;Request.requests[this.index]=this}}onSuccess(){this.emit("success");this.cleanup()}onData(data){this.emit("data",data);this.onSuccess()}onError(err){this.emit("error",err);this.cleanup(true)}cleanup(fromError){if("undefined"===typeof this.xhr||null===this.xhr){return}this.xhr.onreadystatechange=empty;if(fromError){try{this.xhr.abort()}catch(e){}}if(typeof document!=="undefined"){delete Request.requests[this.index]}this.xhr=null}onLoad(){const data=this.xhr.responseText;if(data!==null){this.onData(data)}}abort(){this.cleanup()}}exports.Request=Request;Request.requestsCount=0;Request.requests={};if(typeof document!=="undefined"){if(typeof attachEvent==="function"){attachEvent("onunload",unloadHandler)}else if(typeof addEventListener==="function"){const terminationEvent="onpagehide"in globalThis_js_1.default?"pagehide":"unload";addEventListener(terminationEvent,unloadHandler,false)}}function unloadHandler(){for(let i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}},{"../globalThis.js":6,"../util.js":16,"./polling.js":12,"./xmlhttprequest.js":15,"@socket.io/component-emitter":2,debug:17}],12:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.Polling=void 0;const transport_js_1=require("../transport.js");const debug_1=__importDefault(require("debug"));const yeast_1=__importDefault(require("yeast"));const parseqs_1=__importDefault(require("parseqs"));const engine_io_parser_1=require("engine.io-parser");const debug=(0,debug_1.default)("engine.io-client:polling");class Polling extends transport_js_1.Transport{constructor(){super(...arguments);this.polling=false}get name(){return"polling"}doOpen(){this.poll()}pause(onPause){this.readyState="pausing";const pause=()=>{debug("paused");this.readyState="paused";onPause()};if(this.polling||!this.writable){let total=0;if(this.polling){debug("we are currently polling - waiting to pause");total++;this.once("pollComplete",function(){debug("pre-pause polling complete");--total||pause()})}if(!this.writable){debug("we are currently writing - waiting to pause");total++;this.once("drain",function(){debug("pre-pause writing complete");--total||pause()})}}else{pause()}}poll(){debug("polling");this.polling=true;this.doPoll();this.emit("poll")}onData(data){debug("polling got data %s",data);const callback=packet=>{if("opening"===this.readyState&&packet.type==="open"){this.onOpen()}if("close"===packet.type){this.onClose();return false}this.onPacket(packet)};(0,engine_io_parser_1.decodePayload)(data,this.socket.binaryType).forEach(callback);if("closed"!==this.readyState){this.polling=false;this.emit("pollComplete");if("open"===this.readyState){this.poll()}else{debug('ignoring poll - transport state "%s"',this.readyState)}}}doClose(){const close=()=>{debug("writing close packet");this.write([{type:"close"}])};if("open"===this.readyState){debug("transport open - closing");close()}else{debug("transport not open - deferring close");this.once("open",close)}}write(packets){this.writable=false;(0,engine_io_parser_1.encodePayload)(packets,data=>{this.doWrite(data,()=>{this.writable=true;this.emit("drain")})})}uri(){let query=this.query||{};const schema=this.opts.secure?"https":"http";let port="";if(false!==this.opts.timestampRequests){query[this.opts.timestampParam]=(0,yeast_1.default)()}if(!this.supportsBinary&&!query.sid){query.b64=1}if(this.opts.port&&("https"===schema&&Number(this.opts.port)!==443||"http"===schema&&Number(this.opts.port)!==80)){port=":"+this.opts.port}const encodedQuery=parseqs_1.default.encode(query);const ipv6=this.opts.hostname.indexOf(":")!==-1;return schema+"://"+(ipv6?"["+this.opts.hostname+"]":this.opts.hostname)+port+this.opts.path+(encodedQuery.length?"?"+encodedQuery:"")}}exports.Polling=Polling},{"../transport.js":9,debug:17,"engine.io-parser":23,parseqs:26,yeast:40}],13:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.defaultBinaryType=exports.usingBrowserWebSocket=exports.WebSocket=exports.nextTick=void 0;const globalThis_js_1=__importDefault(require("../globalThis.js"));exports.nextTick=(()=>{const isPromiseAvailable=typeof Promise==="function"&&typeof Promise.resolve==="function";if(isPromiseAvailable){return cb=>Promise.resolve().then(cb)}else{return(cb,setTimeoutFn)=>setTimeoutFn(cb,0)}})();exports.WebSocket=globalThis_js_1.default.WebSocket||globalThis_js_1.default.MozWebSocket;exports.usingBrowserWebSocket=true;exports.defaultBinaryType="arraybuffer"},{"../globalThis.js":6}],14:[function(require,module,exports){(function(Buffer){(function(){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.WS=void 0;const transport_js_1=require("../transport.js");const parseqs_1=__importDefault(require("parseqs"));const yeast_1=__importDefault(require("yeast"));const util_js_1=require("../util.js");const websocket_constructor_js_1=require("./websocket-constructor.js");const debug_1=__importDefault(require("debug"));const engine_io_parser_1=require("engine.io-parser");const debug=(0,debug_1.default)("engine.io-client:websocket");const isReactNative=typeof navigator!=="undefined"&&typeof navigator.product==="string"&&navigator.product.toLowerCase()==="reactnative";class WS extends transport_js_1.Transport{constructor(opts){super(opts);this.supportsBinary=!opts.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check()){return}const uri=this.uri();const protocols=this.opts.protocols;const opts=isReactNative?{}:(0,util_js_1.pick)(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");if(this.opts.extraHeaders){opts.headers=this.opts.extraHeaders}try{this.ws=websocket_constructor_js_1.usingBrowserWebSocket&&!isReactNative?protocols?new websocket_constructor_js_1.WebSocket(uri,protocols):new websocket_constructor_js_1.WebSocket(uri):new websocket_constructor_js_1.WebSocket(uri,protocols,opts)}catch(err){return this.emit("error",err)}this.ws.binaryType=this.socket.binaryType||websocket_constructor_js_1.defaultBinaryType;this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{if(this.opts.autoUnref){this.ws._socket.unref()}this.onOpen()};this.ws.onclose=this.onClose.bind(this);this.ws.onmessage=ev=>this.onData(ev.data);this.ws.onerror=e=>this.onError("websocket error",e)}write(packets){this.writable=false;for(let i=0;i<packets.length;i++){const packet=packets[i];const lastPacket=i===packets.length-1;(0,engine_io_parser_1.encodePacket)(packet,this.supportsBinary,data=>{const opts={};if(!websocket_constructor_js_1.usingBrowserWebSocket){if(packet.options){opts.compress=packet.options.compress}if(this.opts.perMessageDeflate){const len="string"===typeof data?Buffer.byteLength(data):data.length;if(len<this.opts.perMessageDeflate.threshold){opts.compress=false}}}try{if(websocket_constructor_js_1.usingBrowserWebSocket){this.ws.send(data)}else{this.ws.send(data,opts)}}catch(e){debug("websocket closed before onclose event")}if(lastPacket){(0,websocket_constructor_js_1.nextTick)(()=>{this.writable=true;this.emit("drain")},this.setTimeoutFn)}})}}doClose(){if(typeof this.ws!=="undefined"){this.ws.close();this.ws=null}}uri(){let query=this.query||{};const schema=this.opts.secure?"wss":"ws";let port="";if(this.opts.port&&("wss"===schema&&Number(this.opts.port)!==443||"ws"===schema&&Number(this.opts.port)!==80)){port=":"+this.opts.port}if(this.opts.timestampRequests){query[this.opts.timestampParam]=(0,yeast_1.default)()}if(!this.supportsBinary){query.b64=1}const encodedQuery=parseqs_1.default.encode(query);const ipv6=this.opts.hostname.indexOf(":")!==-1;return schema+"://"+(ipv6?"["+this.opts.hostname+"]":this.opts.hostname)+port+this.opts.path+(encodedQuery.length?"?"+encodedQuery:"")}check(){return!!websocket_constructor_js_1.WebSocket&&!("__initialize"in websocket_constructor_js_1.WebSocket&&this.name===WS.prototype.name)}}exports.WS=WS}).call(this)}).call(this,require("buffer").Buffer)},{"../transport.js":9,"../util.js":16,"./websocket-constructor.js":13,buffer:5,debug:17,"engine.io-parser":23,parseqs:26,yeast:40}],15:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});const has_cors_1=__importDefault(require("has-cors"));const globalThis_js_1=__importDefault(require("../globalThis.js"));function default_1(opts){const xdomain=opts.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!xdomain||has_cors_1.default)){return new XMLHttpRequest}}catch(e){}if(!xdomain){try{return new globalThis_js_1.default[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(e){}}}exports.default=default_1},{"../globalThis.js":6,"has-cors":24}],16:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.installTimerFunctions=exports.pick=void 0;const globalThis_js_1=__importDefault(require("./globalThis.js"));function pick(obj,...attr){return attr.reduce((acc,k)=>{if(obj.hasOwnProperty(k)){acc[k]=obj[k]}return acc},{})}exports.pick=pick;const NATIVE_SET_TIMEOUT=setTimeout;const NATIVE_CLEAR_TIMEOUT=clearTimeout;function installTimerFunctions(obj,opts){if(opts.useNativeTimers){obj.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThis_js_1.default);obj.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThis_js_1.default)}else{obj.setTimeoutFn=setTimeout.bind(globalThis_js_1.default);obj.clearTimeoutFn=clearTimeout.bind(globalThis_js_1.default)}}exports.installTimerFunctions=installTimerFunctions},{"./globalThis.js":6}],17:[function(require,module,exports){(function(process){(function(){exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=localstorage();exports.destroy=(()=>{let warned=false;return()=>{if(!warned){warned=true;console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}}})();exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function useColors(){if(typeof window!=="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)){return true}if(typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)){return false}return typeof document!=="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function formatArgs(args){args[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+args[0]+(this.useColors?"%c ":" ")+"+"+module.exports.humanize(this.diff);if(!this.useColors){return}const c="color: "+this.color;args.splice(1,0,c,"color: inherit");let index=0;let lastC=0;args[0].replace(/%[a-zA-Z%]/g,match=>{if(match==="%%"){return}index++;if(match==="%c"){lastC=index}});args.splice(lastC,0,c)}exports.log=console.debug||console.log||(()=>{});function save(namespaces){try{if(namespaces){exports.storage.setItem("debug",namespaces)}else{exports.storage.removeItem("debug")}}catch(error){}}function load(){let r;try{r=exports.storage.getItem("debug")}catch(error){}if(!r&&typeof process!=="undefined"&&"env"in process){r=process.env.DEBUG}return r}function localstorage(){try{return localStorage}catch(error){}}module.exports=require("./common")(exports);const{formatters}=module.exports;formatters.j=function(v){try{return JSON.stringify(v)}catch(error){return"[UnexpectedJSONParseError]: "+error.message}}}).call(this)}).call(this,require("_process"))},{"./common":18,_process:28}],18:[function(require,module,exports){function setup(env){createDebug.debug=createDebug;createDebug.default=createDebug;createDebug.coerce=coerce;createDebug.disable=disable;createDebug.enable=enable;createDebug.enabled=enabled;createDebug.humanize=require("ms");createDebug.destroy=destroy;Object.keys(env).forEach(key=>{createDebug[key]=env[key]});createDebug.names=[];createDebug.skips=[];createDebug.formatters={};function selectColor(namespace){let hash=0;for(let i=0;i<namespace.length;i++){hash=(hash<<5)-hash+namespace.charCodeAt(i);hash|=0}return createDebug.colors[Math.abs(hash)%createDebug.colors.length]}createDebug.selectColor=selectColor;function createDebug(namespace){let prevTime;let enableOverride=null;let namespacesCache;let enabledCache;function debug(...args){if(!debug.enabled){return}const self=debug;const curr=Number(new Date);const ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;args[0]=createDebug.coerce(args[0]);if(typeof args[0]!=="string"){args.unshift("%O")}let index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,(match,format)=>{if(match==="%%"){return"%"}index++;const formatter=createDebug.formatters[format];if(typeof formatter==="function"){const val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});createDebug.formatArgs.call(self,args);const logFn=self.log||createDebug.log;logFn.apply(self,args)}debug.namespace=namespace;debug.useColors=createDebug.useColors();debug.color=createDebug.selectColor(namespace);debug.extend=extend;debug.destroy=createDebug.destroy;Object.defineProperty(debug,"enabled",{enumerable:true,configurable:false,get:()=>{if(enableOverride!==null){return enableOverride}if(namespacesCache!==createDebug.namespaces){namespacesCache=createDebug.namespaces;enabledCache=createDebug.enabled(namespace)}return enabledCache},set:v=>{enableOverride=v}});if(typeof createDebug.init==="function"){createDebug.init(debug)}return debug}function extend(namespace,delimiter){const newDebug=createDebug(this.namespace+(typeof delimiter==="undefined"?":":delimiter)+namespace);newDebug.log=this.log;return newDebug}function enable(namespaces){createDebug.save(namespaces);createDebug.namespaces=namespaces;createDebug.names=[];createDebug.skips=[];let i;const split=(typeof namespaces==="string"?namespaces:"").split(/[\s,]+/);const len=split.length;for(i=0;i<len;i++){if(!split[i]){continue}namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){createDebug.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{createDebug.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){const namespaces=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map(namespace=>"-"+namespace)].join(",");createDebug.enable("");return namespaces}function enabled(name){if(name[name.length-1]==="*"){return true}let i;let len;for(i=0,len=createDebug.skips.length;i<len;i++){if(createDebug.skips[i].test(name)){return false}}for(i=0,len=createDebug.names.length;i<len;i++){if(createDebug.names[i].test(name)){return true}}return false}function toNamespace(regexp){return regexp.toString().substring(2,regexp.toString().length-2).replace(/\.\*\?$/,"*")}function coerce(val){if(val instanceof Error){return val.stack||val.message}return val}function destroy(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}createDebug.enable(createDebug.load());return createDebug}module.exports=setup},{ms:19}],19:[function(require,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var w=d*7;var y=d*365.25;module.exports=function(val,options){options=options||{};var type=typeof val;if(type==="string"&&val.length>0){return parse(val)}else if(type==="number"&&isFinite(val)){return options.long?fmtLong(val):fmtShort(val)}throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))};function parse(str){str=String(str);if(str.length>100){return}var match=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(str);if(!match){return}var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"weeks":case"week":case"w":return n*w;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return undefined}}function fmtShort(ms){var msAbs=Math.abs(ms);if(msAbs>=d){return Math.round(ms/d)+"d"}if(msAbs>=h){return Math.round(ms/h)+"h"}if(msAbs>=m){return Math.round(ms/m)+"m"}if(msAbs>=s){return Math.round(ms/s)+"s"}return ms+"ms"}function fmtLong(ms){var msAbs=Math.abs(ms);if(msAbs>=d){return plural(ms,msAbs,d,"day")}if(msAbs>=h){return plural(ms,msAbs,h,"hour")}if(msAbs>=m){return plural(ms,msAbs,m,"minute")}if(msAbs>=s){return plural(ms,msAbs,s,"second")}return ms+" ms"}function plural(ms,msAbs,n,name){var isPlural=msAbs>=n*1.5;return Math.round(ms/n)+" "+name+(isPlural?"s":"")}},{}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ERROR_PACKET=exports.PACKET_TYPES_REVERSE=exports.PACKET_TYPES=void 0;const PACKET_TYPES=Object.create(null);exports.PACKET_TYPES=PACKET_TYPES;PACKET_TYPES["open"]="0";PACKET_TYPES["close"]="1";PACKET_TYPES["ping"]="2";PACKET_TYPES["pong"]="3";PACKET_TYPES["message"]="4";PACKET_TYPES["upgrade"]="5";PACKET_TYPES["noop"]="6";const PACKET_TYPES_REVERSE=Object.create(null);exports.PACKET_TYPES_REVERSE=PACKET_TYPES_REVERSE;Object.keys(PACKET_TYPES).forEach(key=>{PACKET_TYPES_REVERSE[PACKET_TYPES[key]]=key});const ERROR_PACKET={type:"error",data:"parser error"};exports.ERROR_PACKET=ERROR_PACKET},{}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const commons_js_1=require("./commons.js");const base64_arraybuffer_1=require("@socket.io/base64-arraybuffer");const withNativeArrayBuffer=typeof ArrayBuffer==="function";const decodePacket=(encodedPacket,binaryType)=>{if(typeof encodedPacket!=="string"){return{type:"message",data:mapBinary(encodedPacket,binaryType)}}const type=encodedPacket.charAt(0);if(type==="b"){return{type:"message",data:decodeBase64Packet(encodedPacket.substring(1),binaryType)}}const packetType=commons_js_1.PACKET_TYPES_REVERSE[type];if(!packetType){return commons_js_1.ERROR_PACKET}return encodedPacket.length>1?{type:commons_js_1.PACKET_TYPES_REVERSE[type],data:encodedPacket.substring(1)}:{type:commons_js_1.PACKET_TYPES_REVERSE[type]}};const decodeBase64Packet=(data,binaryType)=>{if(withNativeArrayBuffer){const decoded=(0,base64_arraybuffer_1.decode)(data);return mapBinary(decoded,binaryType)}else{return{base64:true,data:data}}};const mapBinary=(data,binaryType)=>{switch(binaryType){case"blob":return data instanceof ArrayBuffer?new Blob([data]):data;case"arraybuffer":default:return data}};exports.default=decodePacket},{"./commons.js":20,"@socket.io/base64-arraybuffer":1}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const commons_js_1=require("./commons.js");const withNativeBlob=typeof Blob==="function"||typeof Blob!=="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]";const withNativeArrayBuffer=typeof ArrayBuffer==="function";const isView=obj=>{return typeof ArrayBuffer.isView==="function"?ArrayBuffer.isView(obj):obj&&obj.buffer instanceof ArrayBuffer};const encodePacket=({type,data},supportsBinary,callback)=>{if(withNativeBlob&&data instanceof Blob){if(supportsBinary){return callback(data)}else{return encodeBlobAsBase64(data,callback)}}else if(withNativeArrayBuffer&&(data instanceof ArrayBuffer||isView(data))){if(supportsBinary){return callback(data)}else{return encodeBlobAsBase64(new Blob([data]),callback)}}return callback(commons_js_1.PACKET_TYPES[type]+(data||""))};const encodeBlobAsBase64=(data,callback)=>{const fileReader=new FileReader;fileReader.onload=function(){const content=fileReader.result.split(",")[1];callback("b"+content)};return fileReader.readAsDataURL(data)};exports.default=encodePacket},{"./commons.js":20}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.decodePayload=exports.decodePacket=exports.encodePayload=exports.encodePacket=exports.protocol=void 0;const encodePacket_js_1=require("./encodePacket.js");exports.encodePacket=encodePacket_js_1.default;const decodePacket_js_1=require("./decodePacket.js");exports.decodePacket=decodePacket_js_1.default;const SEPARATOR=String.fromCharCode(30);const encodePayload=(packets,callback)=>{const length=packets.length;const encodedPackets=new Array(length);let count=0;packets.forEach((packet,i)=>{(0,encodePacket_js_1.default)(packet,false,encodedPacket=>{encodedPackets[i]=encodedPacket;if(++count===length){callback(encodedPackets.join(SEPARATOR))}})})};exports.encodePayload=encodePayload;const decodePayload=(encodedPayload,binaryType)=>{const encodedPackets=encodedPayload.split(SEPARATOR);const packets=[];for(let i=0;i<encodedPackets.length;i++){const decodedPacket=(0,decodePacket_js_1.default)(encodedPackets[i],binaryType);packets.push(decodedPacket);if(decodedPacket.type==="error"){break}}return packets};exports.decodePayload=decodePayload;exports.protocol=4},{"./decodePacket.js":21,"./encodePacket.js":22}],24:[function(require,module,exports){try{module.exports=typeof XMLHttpRequest!=="undefined"&&"withCredentials"in new XMLHttpRequest}catch(err){module.exports=false}},{}],25:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],26:[function(require,module,exports){exports.encode=function(obj){var str="";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+="&";str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split("&");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],27:[function(require,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function parseuri(str){var src=str,b=str.indexOf("["),e=str.indexOf("]");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length)}var m=re.exec(str||""),uri={},i=14;while(i--){uri[parts[i]]=m[i]||""}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":");uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":");uri.ipv6uri=true}uri.pathNames=pathNames(uri,uri["path"]);uri.queryKey=queryKey(uri,uri["query"]);return uri};function pathNames(obj,path){var regx=/\/{2,9}/g,names=path.replace(regx,"/").split("/");if(path.substr(0,1)=="/"||path.length===0){names.splice(0,1)}if(path.substr(path.length-1,1)=="/"){names.splice(names.length-1,1)}return names}function queryKey(uri,query){var data={};query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function($0,$1,$2){if($1){data[$1]=$2}});return data}},{}],28:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],29:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.connect=exports.io=exports.Socket=exports.Manager=exports.protocol=void 0;const url_js_1=require("./url.js");const manager_js_1=require("./manager.js");Object.defineProperty(exports,"Manager",{enumerable:true,get:function(){return manager_js_1.Manager}});const socket_js_1=require("./socket.js");Object.defineProperty(exports,"Socket",{enumerable:true,get:function(){return socket_js_1.Socket}});const debug_1=__importDefault(require("debug"));const debug=debug_1.default("socket.io-client");const cache={};function lookup(uri,opts){if(typeof uri==="object"){opts=uri;uri=undefined}opts=opts||{};const parsed=url_js_1.url(uri,opts.path||"/socket.io");const source=parsed.source;const id=parsed.id;const path=parsed.path;const sameNamespace=cache[id]&&path in cache[id]["nsps"];const newConnection=opts.forceNew||opts["force new connection"]||false===opts.multiplex||sameNamespace;let io;if(newConnection){debug("ignoring socket cache for %s",source);io=new manager_js_1.Manager(source,opts)}else{if(!cache[id]){debug("new io instance for %s",source);cache[id]=new manager_js_1.Manager(source,opts)}io=cache[id]}if(parsed.query&&!opts.query){opts.query=parsed.queryKey}return io.socket(parsed.path,opts)}exports.io=lookup;exports.connect=lookup;exports.default=lookup;Object.assign(lookup,{Manager:manager_js_1.Manager,Socket:socket_js_1.Socket,io:lookup,connect:lookup});var socket_io_parser_1=require("socket.io-parser");Object.defineProperty(exports,"protocol",{enumerable:true,get:function(){return socket_io_parser_1.protocol}});module.exports=lookup},{"./manager.js":30,"./socket.js":32,"./url.js":33,debug:34,"socket.io-parser":38}],30:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;Object.defineProperty(o,k2,{enumerable:true,get:function(){return m[k]}})}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.Manager=void 0;const engine_io_client_1=require("engine.io-client");const socket_js_1=require("./socket.js");const parser=__importStar(require("socket.io-parser"));const on_js_1=require("./on.js");const backo2_1=__importDefault(require("backo2"));const component_emitter_1=require("@socket.io/component-emitter");const debug_1=__importDefault(require("debug"));const debug=debug_1.default("socket.io-client:manager");class Manager extends component_emitter_1.Emitter{constructor(uri,opts){var _a;super();this.nsps={};this.subs=[];if(uri&&"object"===typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||"/socket.io";this.opts=opts;engine_io_client_1.installTimerFunctions(this,opts);this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor((_a=opts.randomizationFactor)!==null&&_a!==void 0?_a:.5);this.backoff=new backo2_1.default({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this._readyState="closed";this.uri=uri;const _parser=opts.parser||parser;this.encoder=new _parser.Encoder;this.decoder=new _parser.Decoder;this._autoConnect=opts.autoConnect!==false;if(this._autoConnect)this.open()}reconnection(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this}reconnectionAttempts(v){if(v===undefined)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this}reconnectionDelay(v){var _a;if(v===undefined)return this._reconnectionDelay;this._reconnectionDelay=v;(_a=this.backoff)===null||_a===void 0?void 0:_a.setMin(v);return this}randomizationFactor(v){var _a;if(v===undefined)return this._randomizationFactor;this._randomizationFactor=v;(_a=this.backoff)===null||_a===void 0?void 0:_a.setJitter(v);return this}reconnectionDelayMax(v){var _a;if(v===undefined)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;(_a=this.backoff)===null||_a===void 0?void 0:_a.setMax(v);return this}timeout(v){if(!arguments.length)return this._timeout;this._timeout=v;return this}maybeReconnectOnOpen(){if(!this._reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}}open(fn){debug("readyState %s",this._readyState);if(~this._readyState.indexOf("open"))return this;debug("opening %s",this.uri);this.engine=new engine_io_client_1.Socket(this.uri,this.opts);const socket=this.engine;const self=this;this._readyState="opening";this.skipReconnect=false;const openSubDestroy=on_js_1.on(socket,"open",function(){self.onopen();fn&&fn()});const errorSub=on_js_1.on(socket,"error",err=>{debug("error");self.cleanup();self._readyState="closed";this.emitReserved("error",err);if(fn){fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){const timeout=this._timeout;debug("connect attempt will timeout after %d",timeout);if(timeout===0){openSubDestroy()}const timer=this.setTimeoutFn(()=>{debug("connect attempt timed out after %d",timeout);openSubDestroy();socket.close();socket.emit("error",new Error("timeout"))},timeout);if(this.opts.autoUnref){timer.unref()}this.subs.push(function subDestroy(){clearTimeout(timer)})}this.subs.push(openSubDestroy);this.subs.push(errorSub);return this}connect(fn){return this.open(fn)}onopen(){debug("open");this.cleanup();this._readyState="open";this.emitReserved("open");const socket=this.engine;this.subs.push(on_js_1.on(socket,"ping",this.onping.bind(this)),on_js_1.on(socket,"data",this.ondata.bind(this)),on_js_1.on(socket,"error",this.onerror.bind(this)),on_js_1.on(socket,"close",this.onclose.bind(this)),on_js_1.on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(data){this.decoder.add(data)}ondecoded(packet){this.emitReserved("packet",packet)}onerror(err){debug("error",err);this.emitReserved("error",err)}socket(nsp,opts){let socket=this.nsps[nsp];if(!socket){socket=new socket_js_1.Socket(this,nsp,opts);this.nsps[nsp]=socket}return socket}_destroy(socket){const nsps=Object.keys(this.nsps);for(const nsp of nsps){const socket=this.nsps[nsp];if(socket.active){debug("socket %s is still active, skipping close",nsp);return}}this._close()}_packet(packet){debug("writing packet %j",packet);const encodedPackets=this.encoder.encode(packet);for(let i=0;i<encodedPackets.length;i++){this.engine.write(encodedPackets[i],packet.options)}}cleanup(){debug("cleanup");this.subs.forEach(subDestroy=>subDestroy());this.subs.length=0;this.decoder.destroy()}_close(){debug("disconnect");this.skipReconnect=true;this._reconnecting=false;this.onclose("forced close");if(this.engine)this.engine.close()}disconnect(){return this._close()}onclose(reason){debug("closed due to %s",reason);this.cleanup();this.backoff.reset();this._readyState="closed";this.emitReserved("close",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug("reconnect failed");this.backoff.reset();this.emitReserved("reconnect_failed");this._reconnecting=false}else{const delay=this.backoff.duration();debug("will wait %dms before reconnect attempt",delay);this._reconnecting=true;const timer=this.setTimeoutFn(()=>{if(self.skipReconnect)return;debug("attempting reconnect");this.emitReserved("reconnect_attempt",self.backoff.attempts);if(self.skipReconnect)return;self.open(err=>{if(err){debug("reconnect attempt error");self._reconnecting=false;self.reconnect();this.emitReserved("reconnect_error",err)}else{debug("reconnect success");self.onreconnect()}})},delay);if(this.opts.autoUnref){timer.unref()}this.subs.push(function subDestroy(){clearTimeout(timer)})}}onreconnect(){const attempt=this.backoff.attempts;this._reconnecting=false;this.backoff.reset();this.emitReserved("reconnect",attempt)}}exports.Manager=Manager},{"./on.js":31,"./socket.js":32,"@socket.io/component-emitter":2,backo2:3,debug:34,"engine.io-client":7,"socket.io-parser":38}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.on=void 0;function on(obj,ev,fn){obj.on(ev,fn);return function subDestroy(){obj.off(ev,fn)}}exports.on=on},{}],32:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.Socket=void 0;const socket_io_parser_1=require("socket.io-parser");const on_js_1=require("./on.js");const component_emitter_1=require("@socket.io/component-emitter");const debug_1=__importDefault(require("debug"));const debug=debug_1.default("socket.io-client:socket");const RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Socket extends component_emitter_1.Emitter{constructor(io,nsp,opts){super();this.connected=false;this.disconnected=true;this.receiveBuffer=[];this.sendBuffer=[];this.ids=0;this.acks={};this.flags={};this.io=io;this.nsp=nsp;if(opts&&opts.auth){this.auth=opts.auth}if(this.io._autoConnect)this.open()}subEvents(){if(this.subs)return;const io=this.io;this.subs=[on_js_1.on(io,"open",this.onopen.bind(this)),on_js_1.on(io,"packet",this.onpacket.bind(this)),on_js_1.on(io,"error",this.onerror.bind(this)),on_js_1.on(io,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){if(this.connected)return this;this.subEvents();if(!this.io["_reconnecting"])this.io.open();if("open"===this.io._readyState)this.onopen();return this}open(){return this.connect()}send(...args){args.unshift("message");this.emit.apply(this,args);return this}emit(ev,...args){if(RESERVED_EVENTS.hasOwnProperty(ev)){throw new Error('"'+ev+'" is a reserved event name')}args.unshift(ev);const packet={type:socket_io_parser_1.PacketType.EVENT,data:args};packet.options={};packet.options.compress=this.flags.compress!==false;if("function"===typeof args[args.length-1]){const id=this.ids++;debug("emitting packet with ack id %d",id);const ack=args.pop();this._registerAckCallback(id,ack);packet.id=id}const isTransportWritable=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;const discardPacket=this.flags.volatile&&(!isTransportWritable||!this.connected);if(discardPacket){debug("discard packet as the transport is not currently writable")}else if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}this.flags={};return this}_registerAckCallback(id,ack){const timeout=this.flags.timeout;if(timeout===undefined){this.acks[id]=ack;return}const timer=this.io.setTimeoutFn(()=>{delete this.acks[id];for(let i=0;i<this.sendBuffer.length;i++){if(this.sendBuffer[i].id===id){debug("removing packet with ack id %d from the buffer",id);this.sendBuffer.splice(i,1)}}debug("event with ack id %d has timed out after %d ms",id,timeout);ack.call(this,new Error("operation has timed out"))},timeout);this.acks[id]=(...args)=>{this.io.clearTimeoutFn(timer);ack.apply(this,[null,...args])}}packet(packet){packet.nsp=this.nsp;this.io._packet(packet)}onopen(){debug("transport is open - connecting");if(typeof this.auth=="function"){this.auth(data=>{this.packet({type:socket_io_parser_1.PacketType.CONNECT,data:data})})}else{this.packet({type:socket_io_parser_1.PacketType.CONNECT,data:this.auth})}}onerror(err){if(!this.connected){this.emitReserved("connect_error",err)}}onclose(reason){debug("close (%s)",reason);this.connected=false;this.disconnected=true;delete this.id;this.emitReserved("disconnect",reason)}onpacket(packet){const sameNamespace=packet.nsp===this.nsp;if(!sameNamespace)return;switch(packet.type){case socket_io_parser_1.PacketType.CONNECT:if(packet.data&&packet.data.sid){const id=packet.data.sid;this.onconnect(id)}else{this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"))}break;case socket_io_parser_1.PacketType.EVENT:this.onevent(packet);break;case socket_io_parser_1.PacketType.BINARY_EVENT:this.onevent(packet);break;case socket_io_parser_1.PacketType.ACK:this.onack(packet);break;case socket_io_parser_1.PacketType.BINARY_ACK:this.onack(packet);break;case socket_io_parser_1.PacketType.DISCONNECT:this.ondisconnect();break;case socket_io_parser_1.PacketType.CONNECT_ERROR:this.destroy();const err=new Error(packet.data.message);err.data=packet.data.data;this.emitReserved("connect_error",err);break}}onevent(packet){const args=packet.data||[];debug("emitting event %j",args);if(null!=packet.id){debug("attaching ack callback to event");args.push(this.ack(packet.id))}if(this.connected){this.emitEvent(args)}else{this.receiveBuffer.push(Object.freeze(args))}}emitEvent(args){if(this._anyListeners&&this._anyListeners.length){const listeners=this._anyListeners.slice();for(const listener of listeners){listener.apply(this,args)}}super.emit.apply(this,args)}ack(id){const self=this;let sent=false;return function(...args){if(sent)return;sent=true;debug("sending ack %j",args);self.packet({type:socket_io_parser_1.PacketType.ACK,id:id,data:args})}}onack(packet){const ack=this.acks[packet.id];if("function"===typeof ack){debug("calling ack %s with %j",packet.id,packet.data);ack.apply(this,packet.data);delete this.acks[packet.id]}else{debug("bad ack %s",packet.id)}}onconnect(id){debug("socket connected with id %s",id);this.id=id;this.connected=true;this.disconnected=false;this.emitBuffered();this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(args=>this.emitEvent(args));this.receiveBuffer=[];this.sendBuffer.forEach(packet=>this.packet(packet));this.sendBuffer=[]}ondisconnect(){debug("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")}destroy(){if(this.subs){this.subs.forEach(subDestroy=>subDestroy());this.subs=undefined}this.io["_destroy"](this)}disconnect(){if(this.connected){debug("performing disconnect (%s)",this.nsp);this.packet({type:socket_io_parser_1.PacketType.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this}close(){return this.disconnect()}compress(compress){this.flags.compress=compress;return this}get volatile(){this.flags.volatile=true;return this}timeout(timeout){this.flags.timeout=timeout;return this}onAny(listener){this._anyListeners=this._anyListeners||[];this._anyListeners.push(listener);return this}prependAny(listener){this._anyListeners=this._anyListeners||[];this._anyListeners.unshift(listener);return this}offAny(listener){if(!this._anyListeners){return this}if(listener){const listeners=this._anyListeners;for(let i=0;i<listeners.length;i++){if(listener===listeners[i]){listeners.splice(i,1);return this}}}else{this._anyListeners=[]}return this}listenersAny(){return this._anyListeners||[]}}exports.Socket=Socket},{"./on.js":31,"@socket.io/component-emitter":2,debug:34,"socket.io-parser":38}],33:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.url=void 0;const parseuri_1=__importDefault(require("parseuri"));const debug_1=__importDefault(require("debug"));const debug=debug_1.default("socket.io-client:url");function url(uri,path="",loc){let obj=uri;loc=loc||typeof location!=="undefined"&&location;if(null==uri)uri=loc.protocol+"//"+loc.host;if(typeof uri==="string"){if("/"===uri.charAt(0)){if("/"===uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.host+uri}}if(!/^(https?|wss?):\/\//.test(uri)){debug("protocol-less url %s",uri);if("undefined"!==typeof loc){uri=loc.protocol+"//"+uri}else{uri="https://"+uri}}debug("parse %s",uri);obj=parseuri_1.default(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port="80"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port="443"}}obj.path=obj.path||"/";const ipv6=obj.host.indexOf(":")!==-1;const host=ipv6?"["+obj.host+"]":obj.host;obj.id=obj.protocol+"://"+host+":"+obj.port+path;obj.href=obj.protocol+"://"+host+(loc&&loc.port===obj.port?"":":"+obj.port);return obj}exports.url=url},{debug:34,parseuri:27}],34:[function(require,module,exports){arguments[4][17][0].apply(exports,arguments)},{"./common":35,_process:28,dup:17}],35:[function(require,module,exports){arguments[4][18][0].apply(exports,arguments)},{dup:18,ms:36}],36:[function(require,module,exports){arguments[4][19][0].apply(exports,arguments)},{dup:19}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.reconstructPacket=exports.deconstructPacket=void 0;const is_binary_js_1=require("./is-binary.js");function deconstructPacket(packet){const buffers=[];const packetData=packet.data;const pack=packet;pack.data=_deconstructPacket(packetData,buffers);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}}exports.deconstructPacket=deconstructPacket;function _deconstructPacket(data,buffers){if(!data)return data;if(is_binary_js_1.isBinary(data)){const placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(Array.isArray(data)){const newData=new Array(data.length);for(let i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i],buffers)}return newData}else if(typeof data==="object"&&!(data instanceof Date)){const newData={};for(const key in data){if(data.hasOwnProperty(key)){newData[key]=_deconstructPacket(data[key],buffers)}}return newData}return data}function reconstructPacket(packet,buffers){packet.data=_reconstructPacket(packet.data,buffers);packet.attachments=undefined;return packet}exports.reconstructPacket=reconstructPacket;function _reconstructPacket(data,buffers){if(!data)return data;if(data&&data._placeholder){return buffers[data.num]}else if(Array.isArray(data)){for(let i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i],buffers)}}else if(typeof data==="object"){for(const key in data){if(data.hasOwnProperty(key)){data[key]=_reconstructPacket(data[key],buffers)}}}return data}},{"./is-binary.js":39}],38:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Decoder=exports.Encoder=exports.PacketType=exports.protocol=void 0;const component_emitter_1=require("@socket.io/component-emitter");const binary_js_1=require("./binary.js");const is_binary_js_1=require("./is-binary.js");const debug_1=require("debug");const debug=debug_1.default("socket.io-parser");exports.protocol=5;var PacketType;(function(PacketType){PacketType[PacketType["CONNECT"]=0]="CONNECT";PacketType[PacketType["DISCONNECT"]=1]="DISCONNECT";PacketType[PacketType["EVENT"]=2]="EVENT";PacketType[PacketType["ACK"]=3]="ACK";PacketType[PacketType["CONNECT_ERROR"]=4]="CONNECT_ERROR";PacketType[PacketType["BINARY_EVENT"]=5]="BINARY_EVENT";PacketType[PacketType["BINARY_ACK"]=6]="BINARY_ACK"})(PacketType=exports.PacketType||(exports.PacketType={}));class Encoder{encode(obj){debug("encoding packet %j",obj);if(obj.type===PacketType.EVENT||obj.type===PacketType.ACK){if(is_binary_js_1.hasBinary(obj)){obj.type=obj.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK;return this.encodeAsBinary(obj)}}return[this.encodeAsString(obj)]}encodeAsString(obj){let str=""+obj.type;if(obj.type===PacketType.BINARY_EVENT||obj.type===PacketType.BINARY_ACK){str+=obj.attachments+"-"}if(obj.nsp&&"/"!==obj.nsp){str+=obj.nsp+","}if(null!=obj.id){str+=obj.id}if(null!=obj.data){str+=JSON.stringify(obj.data)}debug("encoded %j as %s",obj,str);return str}encodeAsBinary(obj){const deconstruction=binary_js_1.deconstructPacket(obj);const pack=this.encodeAsString(deconstruction.packet);const buffers=deconstruction.buffers;buffers.unshift(pack);return buffers}}exports.Encoder=Encoder;class Decoder extends component_emitter_1.Emitter{constructor(){super()}add(obj){let packet;if(typeof obj==="string"){packet=this.decodeString(obj);if(packet.type===PacketType.BINARY_EVENT||packet.type===PacketType.BINARY_ACK){this.reconstructor=new BinaryReconstructor(packet);if(packet.attachments===0){super.emitReserved("decoded",packet)}}else{super.emitReserved("decoded",packet)}}else if(is_binary_js_1.isBinary(obj)||obj.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;super.emitReserved("decoded",packet)}}}else{throw new Error("Unknown type: "+obj)}}decodeString(str){let i=0;const p={type:Number(str.charAt(0))};if(PacketType[p.type]===undefined){throw new Error("unknown packet type "+p.type)}if(p.type===PacketType.BINARY_EVENT||p.type===PacketType.BINARY_ACK){const start=i+1;while(str.charAt(++i)!=="-"&&i!=str.length){}const buf=str.substring(start,i);if(buf!=Number(buf)||str.charAt(i)!=="-"){throw new Error("Illegal attachments")}p.attachments=Number(buf)}if("/"===str.charAt(i+1)){const start=i+1;while(++i){const c=str.charAt(i);if(","===c)break;if(i===str.length)break}p.nsp=str.substring(start,i)}else{p.nsp="/"}const next=str.charAt(i+1);if(""!==next&&Number(next)==next){const start=i+1;while(++i){const c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}if(i===str.length)break}p.id=Number(str.substring(start,i+1))}if(str.charAt(++i)){const payload=tryParse(str.substr(i));if(Decoder.isPayloadValid(p.type,payload)){p.data=payload}else{throw new Error("invalid payload")}}debug("decoded %s as %j",str,p);return p}static isPayloadValid(type,payload){switch(type){case PacketType.CONNECT:return typeof payload==="object";case PacketType.DISCONNECT:return payload===undefined;case PacketType.CONNECT_ERROR:return typeof payload==="string"||typeof payload==="object";case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(payload)&&payload.length>0;case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(payload)}}destroy(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}}}exports.Decoder=Decoder;function tryParse(str){try{return JSON.parse(str)}catch(e){return false}}class BinaryReconstructor{constructor(packet){this.packet=packet;this.buffers=[];this.reconPack=packet}takeBinaryData(binData){this.buffers.push(binData);if(this.buffers.length===this.reconPack.attachments){const packet=binary_js_1.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null}finishedReconstruction(){this.reconPack=null;this.buffers=[]}}},{"./binary.js":37,"./is-binary.js":39,"@socket.io/component-emitter":2,debug:34}],39:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.hasBinary=exports.isBinary=void 0;const withNativeArrayBuffer=typeof ArrayBuffer==="function";const isView=obj=>{return typeof ArrayBuffer.isView==="function"?ArrayBuffer.isView(obj):obj.buffer instanceof ArrayBuffer};const toString=Object.prototype.toString;const withNativeBlob=typeof Blob==="function"||typeof Blob!=="undefined"&&toString.call(Blob)==="[object BlobConstructor]";const withNativeFile=typeof File==="function"||typeof File!=="undefined"&&toString.call(File)==="[object FileConstructor]";function isBinary(obj){return withNativeArrayBuffer&&(obj instanceof ArrayBuffer||isView(obj))||withNativeBlob&&obj instanceof Blob||withNativeFile&&obj instanceof File}exports.isBinary=isBinary;function hasBinary(obj,toJSON){if(!obj||typeof obj!=="object"){return false}if(Array.isArray(obj)){for(let i=0,l=obj.length;i<l;i++){if(hasBinary(obj[i])){return true}}return false}if(isBinary(obj)){return true}if(obj.toJSON&&typeof obj.toJSON==="function"&&arguments.length===1){return hasBinary(obj.toJSON(),true)}for(const key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&hasBinary(obj[key])){return true}}return false}exports.hasBinary=hasBinary},{}],40:[function(require,module,exports){"use strict";var alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={},seed=0,i=0,prev;function encode(num){var encoded="";do{encoded=alphabet[num%length]+encoded;num=Math.floor(num/length)}while(num>0);return encoded}function decode(str){var decoded=0;for(i=0;i<str.length;i++){decoded=decoded*length+map[str.charAt(i)]}return decoded}function yeast(){var now=encode(+new Date);if(now!==prev)return seed=0,prev=now;return now+"."+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode;yeast.decode=decode;module.exports=yeast},{}],41:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.BaseScene=exports.wait=exports._CGame=void 0;function wait(time){return new Promise((resolve,_)=>setTimeout(resolve,time))}exports.wait=wait;class _CGame{_startingScene;ctx;fps;width;height;static detectMobile(){const a=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))){return true}return false}getMousePos(event){const rect=this.ctx.canvas.getBoundingClientRect();const x=(event.clientX-rect.left)*(this.ctx.canvas.width/rect.width);const y=(event.clientY-rect.top)*(this.ctx.canvas.height/rect.height);if(x<0||x>this.ctx.canvas.width||y<0||y>this.ctx.canvas.height)return;return{x:x,y:y}}eventQueue;pressedKeys;alreadyFired;mouse;constructor(_startingScene,ctx,fps,width,height){this._startingScene=_startingScene;this.ctx=ctx;this.fps=fps;this.width=width;this.height=height;this.mouse={x:0,y:0};ctx.canvas.width=width;ctx.canvas.height=height;const resizeWindow=()=>{const scale=Math.min(innerWidth/this.width,innerHeight/this.height);ctx.canvas.style.width=`${this.width*scale}px`;ctx.canvas.style.height=`${this.height*scale}px`};resizeWindow();window.onresize=resizeWindow;this.eventQueue=[];this.pressedKeys=new Map;this.alreadyFired=new Map;document.onkeydown=event=>{if(this.alreadyFired.get(event.code))return;this.alreadyFired.set(event.code,true);this.pressedKeys.set(event.code,true);this.eventQueue.push({eventType:"KeyDown",key:event.key,code:event.code,raw:event})};document.onkeyup=event=>{this.alreadyFired.set(event.code,false);this.pressedKeys.set(event.code,false);this.eventQueue.push({eventType:"KeyUp",key:event.key,code:event.code,raw:event})};document.onmousemove=event=>{if(!this.getMousePos(event))return;this.mouse=this.getMousePos(event);this.eventQueue.push({eventType:"MouseMove",raw:event})};document.onmousedown=event=>{if(!this.getMousePos(event))return;this.pressedKeys.set(event.button===0?"MouseLeft":event.button===1?"MouseMiddle":event.button===2?"MouseRight":"MouseUnknown",true);this.eventQueue.push({eventType:"MouseDown",raw:event})};document.onmouseup=event=>{if(!this.getMousePos(event))return;this.pressedKeys.set(event.button===0?"MouseLeft":event.button===1?"MouseMiddle":event.button===2?"MouseRight":"MouseUnknown",false);this.eventQueue.push({eventType:"MouseUp",raw:event})}}async run(){this.ctx.imageSmoothingEnabled=false;let t=performance.now();let timeLastFrame=t;let scene=new this._startingScene(this);while(scene!==null){t=performance.now();const deltaTime=t-timeLastFrame;timeLastFrame=t;const events=this.eventQueue;this.eventQueue=[];scene.processInput(events,this.pressedKeys,deltaTime);scene.update(deltaTime);this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);scene.draw();scene=scene.next;await wait(1e3/this.fps)}}applyFillOptions(fillOptions){this.ctx.fillStyle=fillOptions?.style?fillOptions.style:"#000000";this.ctx.shadowBlur=fillOptions?.shadowBlur?fillOptions.shadowBlur:0;this.ctx.shadowColor=fillOptions?.shadowColor?fillOptions.shadowColor:"#000000";this.ctx.shadowOffsetX=fillOptions?.shadowOffset?.x?fillOptions.shadowOffset.x:0;this.ctx.shadowOffsetY=fillOptions?.shadowOffset?.y?fillOptions.shadowOffset.y:0}drawRect(rect){this.applyFillOptions(rect.style);this.ctx.fillRect(Math.round(rect.topLeft.x),Math.round(rect.topLeft.y),Math.round(rect.width),Math.round(rect.height))}}exports._CGame=_CGame;class BaseScene{CGame;next;mouse;constructor(CGame){this.CGame=CGame;this.next=this;this.mouse={x:0,y:0}}switchToScene(nextScene){this.next=nextScene}terminateGame(){this.next==null}processInput(events,pressedKeys,dt){throw new Error("processInput wasn't overridden")}update(dt){throw new Error("update wasn't overridden")}draw(){throw new Error("draw wasn't overridden")}}exports.BaseScene=BaseScene},{}],42:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Rect=void 0;class Rect{center;width;height;style;get top(){return this.center.y-this.height/2}set top(top){this.center.y=top+this.height/2}get bottom(){return this.center.y+this.height/2}set bottom(bottom){this.center.y=bottom-this.height/2}get left(){return this.center.x-this.width/2}set left(left){this.center.x=left+this.width/2}get right(){return this.center.x+this.width/2}set right(right){this.center.x=right-this.width/2}get topLeft(){return{x:this.center.x-this.width/2,y:this.center.y-this.height/2}}get bottomRight(){return{x:this.center.x+this.width/2,y:this.center.y+this.height/2}}constructor(center,width,height,style){this.center=center;this.width=width;this.height=height;this.style=style;this.center=center}static topLeftConstructor(topLeft,width,height,style){return new Rect({x:topLeft.x+width/2,y:topLeft.y+height/2},width,height,style)}static bottomRightConstructor(bottomRight,width,height,style){return new Rect({x:bottomRight.x-width/2,y:bottomRight.y-height/2},width,height,style)}static contains(a,b){return!(b.topLeft.x<a.topLeft.x||b.topLeft.y<a.topLeft.y||b.topLeft.x+b.width>a.topLeft.x+a.width||b.topLeft.y+b.height>a.topLeft.y+a.height)}static touches(a,b){if(a.topLeft.x>b.topLeft.x+b.width||b.topLeft.x>a.topLeft.x+a.width)return false;if(a.topLeft.y>b.topLeft.y+b.height||b.topLeft.y>a.topLeft.y+a.height)return false;return true}}exports.Rect=Rect},{}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Client=void 0;const socket_io_client_1=require("socket.io-client");const otherPlayer_1=require("./otherPlayer");class Client{game;io;constructor(game){this.game=game;this.io=(0,socket_io_client_1.io)("http://localhost:3000");this.io.on("playerJoin",username=>{game.otherPlayers[username]=new otherPlayer_1.OtherPlayer(game,game.spawnLocation)});this.io.on("playerLeave",username=>{delete game.otherPlayers[username]});this.io.on("updatePositions",positions=>{for(const username in positions){if(username===game.username)continue;if(!game.otherPlayers[username])game.otherPlayers[username]=new otherPlayer_1.OtherPlayer(game,game.spawnLocation);game.otherPlayers[username].image.center=positions[username].location}})}setUsername(){const username=prompt("username?");this.io.emit("setUsername",username,valid=>{if(valid)this.game.username=username})}createGame(){this.io.emit("create",(error,id)=>{if(error)return;this.game.gameId=id})}update(location){this.io.emit("move",location)}join(id){this.io.emit("join",id,(error,positions)=>{console.log(id,error,positions);if(!error)return;this.game.gameId=id;for(const username in positions){if(username===this.game.username)continue;if(!this.game.otherPlayers[username])this.game.otherPlayers[username]=new otherPlayer_1.OtherPlayer(this.game,this.game.spawnLocation);this.game.otherPlayers[username].image.center=positions[username].location}})}}exports.Client=Client},{"./otherPlayer":45,"socket.io-client":29}],44:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.GameScene=void 0;const framework_1=require("../../../framework/framework");const rect_1=require("../../../framework/shapes/rect");const client_1=require("./client");const player_1=require("./player");const wall_1=require("./wall");class GameScene extends framework_1.BaseScene{player;otherPlayers;walls;client;username;gameId;spawnLocation;constructor(CGame){super(CGame);this.client=new client_1.Client(this);this.spawnLocation={x:this.CGame.ctx.canvas.width/2,y:0};this.player=new player_1.Player(this);this.walls=[new wall_1.Wall(this,{x:this.CGame.width/2,y:this.CGame.height-100},100,50),new wall_1.Wall(this,{x:this.CGame.width/2-100,y:this.CGame.height-150},50,100)];this.otherPlayers={}}processInput(events,pressedKeys,dt){this.player.processInput(events,pressedKeys,dt);events.forEach(event=>{switch(event.eventType){case"KeyDown":event=event;switch(event.code){case"KeyJ":this.client.setUsername();break;case"KeyK":this.client.join(prompt("server"));break;case"KeyL":this.client.createGame();break}break}})}update(dt){this.player.update(dt);this.walls.forEach(wall=>wall.update())}draw(){this.CGame.drawRect(rect_1.Rect.topLeftConstructor({x:0,y:0},this.CGame.width,this.CGame.height,{style:"#f5f5f5"}));this.player.draw();Object.values(this.otherPlayers).forEach(otherPlayer=>otherPlayer.draw());this.walls.forEach(wall=>wall.draw())}}exports.GameScene=GameScene},{"../../../framework/framework":41,"../../../framework/shapes/rect":42,"./client":43,"./player":46,"./wall":47}],45:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.OtherPlayer=void 0;const rect_1=require("../../../framework/shapes/rect");class OtherPlayer{game;image;constructor(game,location){this.game=game;this.image=new rect_1.Rect(location,25,25,{style:"#00FF00",shadowBlur:5,shadowColor:"#000000"})}draw(){this.game.CGame.drawRect(this.image)}}exports.OtherPlayer=OtherPlayer},{"../../../framework/shapes/rect":42}],46:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Player=void 0;const rect_1=require("../../../framework/shapes/rect");class Player{game;hitbox;image;hspd;vspd;speed;_touchingGroundRect;touchingGround;gravitySpeed;_gravityAcceleration;_gravityTopSpeed;jumping;_jumpSpeed;_jumpDuration;_jumpedWhen;constructor(game){this.game=game;this.hspd=0;this.vspd=0;this.hitbox=new rect_1.Rect(game.spawnLocation,25,25);this.image=new rect_1.Rect(this.hitbox.center,this.hitbox.width,this.hitbox.height,{style:"#FF0000",shadowBlur:5,shadowColor:"#000000"});this._touchingGroundRect=new rect_1.Rect({x:this.hitbox.center.x,y:this.hitbox.topLeft.y+this.hitbox.height+5/2},this.hitbox.width,5);this.speed=.5;this.touchingGround=false;this.gravitySpeed=0;this._gravityAcceleration=.05;this._gravityTopSpeed=100;this.jumping=false;this._jumpSpeed=1.2;this._jumpDuration=100;this._jumpedWhen=0}processInput(events,pressedKeys,dt){this.image.center=this.hitbox.center;this._touchingGroundRect.center={x:this.hitbox.center.x,y:this.hitbox.topLeft.y+this.hitbox.height+5/2};this.vspd=0;this.hspd=0;if(pressedKeys.get("KeyA"))this.hspd-=this.speed*dt;if(pressedKeys.get("KeyD"))this.hspd+=this.speed*dt;this.touchingGround=false;for(const wall of this.game.walls){if(rect_1.Rect.touches(wall.hitbox,this._touchingGroundRect)){this.touchingGround=true;break}}if(events.filter(event=>event.eventType==="KeyDown"&&event.code==="Space").length>0&&this.touchingGround){this.jumping=true;this._jumpedWhen=performance.now()}if(this.jumping){console.log("jumping");this.vspd-=this._jumpSpeed*dt;if(performance.now()>=this._jumpedWhen+this._jumpDuration){this.jumping=false}}}update(dt){if(this.touchingGround||this.jumping){this.gravitySpeed=0}else{this.gravitySpeed=Math.min(this._gravityTopSpeed,this.gravitySpeed+this._gravityAcceleration*dt);this.vspd+=this.gravitySpeed}const vFutureHitbox=new rect_1.Rect({...this.hitbox.center,y:this.hitbox.center.y+this.vspd},this.hitbox.width,this.hitbox.height);const hFutureHitbox=new rect_1.Rect({...this.hitbox.center,x:this.hitbox.center.x+this.hspd},this.hitbox.width,this.hitbox.height);let hTouches=false;let vTouches=false;for(const wall of this.game.walls){if(rect_1.Rect.touches(wall.hitbox,vFutureHitbox)){if(this.vspd>0){console.log("Bottom");this.hitbox.bottom=wall.hitbox.top-5/2}else{console.log("Top");this.hitbox.top=wall.hitbox.bottom+5/2}vTouches=true}if(rect_1.Rect.touches(wall.hitbox,hFutureHitbox)){if(this.hspd>0){this.hitbox.right=wall.hitbox.left-5/2}else{this.hitbox.left=wall.hitbox.right+5/2}hTouches=true}}if(!hTouches)this.hitbox.center.x+=this.hspd;if(!vTouches)this.hitbox.center.y+=this.vspd;this.game.client.update(this.hitbox.center)}draw(){this.game.CGame.drawRect(this.image)}}exports.Player=Player},{"../../../framework/shapes/rect":42}],47:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Wall=void 0;const rect_1=require("../../../framework/shapes/rect");class Wall{game;location;width;height;hitbox;image;constructor(game,location,width,height){this.game=game;this.location=location;this.width=width;this.height=height;this.hitbox=new rect_1.Rect(location,width,height);this.image=new rect_1.Rect(location,width,height,{style:"#00FFFF",shadowBlur:5,shadowColor:"#000000"})}update(){this.image.center=this.hitbox.center}draw(){this.game.CGame.drawRect(this.image)}}exports.Wall=Wall},{"../../../framework/shapes/rect":42}],48:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const framework_1=require("./framework/framework");const game_1=require("./game/scenes/game/game");const canvas=document.getElementById("game");if(!canvas)throw new Error('Canvas "game" not found!');const CGame=new framework_1._CGame(game_1.GameScene,canvas.getContext("2d"),60,1280,720);CGame.run()},{"./framework/framework":41,"./game/scenes/game/game":44}]},{},[48]);
