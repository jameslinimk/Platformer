!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var p="function"==typeof require&&require;if(!f&&p)return p(i,!0);if(u)return u(i,!0);throw(p=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",p}p=n[i]={exports:{}},e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){var global,factory;global=this,factory=function(exports){"use strict";for(var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup="undefined"==typeof Uint8Array?[]:new Uint8Array(256),i=0;i<chars.length;i++)lookup[chars.charCodeAt(i)]=i;exports.decode=function(base64){var encoded1,encoded2,encoded3,encoded4,arraybuffer=.75*base64.length,len=base64.length,p=0;"="===base64[base64.length-1]&&(arraybuffer--,"="===base64[base64.length-2]&&arraybuffer--);for(var arraybuffer=new ArrayBuffer(arraybuffer),bytes=new Uint8Array(arraybuffer),i=0;i<len;i+=4)encoded1=lookup[base64.charCodeAt(i)],encoded2=lookup[base64.charCodeAt(i+1)],encoded3=lookup[base64.charCodeAt(i+2)],encoded4=lookup[base64.charCodeAt(i+3)],bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return arraybuffer},exports.encode=function(arraybuffer){for(var bytes=new Uint8Array(arraybuffer),len=bytes.length,base64="",i=0;i<len;i+=3)base64+=chars[bytes[i]>>2],base64+=chars[(3&bytes[i])<<4|bytes[i+1]>>4],base64+=chars[(15&bytes[i+1])<<2|bytes[i+2]>>6],base64+=chars[63&bytes[i+2]];return len%3==2?base64=base64.substring(0,base64.length-1)+"=":len%3==1&&(base64=base64.substring(0,base64.length-2)+"=="),base64},Object.defineProperty(exports,"__esModule",{value:!0})},"object"==typeof exports&&void 0!==module?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):factory((global="undefined"!=typeof globalThis?globalThis:global||self)["base64-arraybuffer"]={})},{}],2:[function(require,module,exports){function Emitter(obj){if(obj)return function(obj){for(var key in Emitter.prototype)obj[key]=Emitter.prototype[key];return obj}(obj)}(exports.Emitter=Emitter).prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks["$"+event]=this._callbacks["$"+event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on(){this.off(event,on),fn.apply(this,arguments)}return on.fn=fn,this.on(event,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var cb,callbacks=this._callbacks["$"+event];if(!callbacks)return this;if(1==arguments.length)return delete this._callbacks["$"+event],this;for(var i=0;i<callbacks.length;i++)if((cb=callbacks[i])===fn||cb.fn===fn){callbacks.splice(i,1);break}return 0===callbacks.length&&delete this._callbacks["$"+event],this},Emitter.prototype.emitReserved=Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};for(var args=new Array(arguments.length-1),callbacks=this._callbacks["$"+event],i=1;i<arguments.length;i++)args[i-1]=arguments[i];if(callbacks)for(var i=0,len=(callbacks=callbacks.slice(0)).length;i<len;++i)callbacks[i].apply(this,args);return this},Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks["$"+event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],3:[function(require,module,exports){function Backoff(opts){this.ms=(opts=opts||{}).min||100,this.max=opts.max||1e4,this.factor=opts.factor||2,this.jitter=0<opts.jitter&&opts.jitter<=1?opts.jitter:0,this.attempts=0}(module.exports=Backoff).prototype.duration=function(){var rand,deviation,ms=this.ms*Math.pow(this.factor,this.attempts++);return this.jitter&&(rand=Math.random(),deviation=Math.floor(rand*this.jitter*ms),ms=0==(1&Math.floor(10*rand))?ms-deviation:ms+deviation),0|Math.min(ms,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(min){this.ms=min},Backoff.prototype.setMax=function(max){this.max=max},Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],4:[function(require,module,exports){"use strict";exports.byteLength=function(validLen){var placeHoldersLen=getLens(validLen),validLen=placeHoldersLen[0],placeHoldersLen=placeHoldersLen[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen},exports.toByteArray=function(b64){var tmp,i,placeHoldersLen=getLens(b64),validLen=placeHoldersLen[0],placeHoldersLen=placeHoldersLen[1],arr=new Arr(function(validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}(validLen,placeHoldersLen)),curByte=0,len=0<placeHoldersLen?validLen-4:validLen;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(function(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(function(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}(tmp));return output.join("")}(uint8,i,len2<i+16383?len2:i+16383));1==extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2==extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"="));return parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(validLen){var len=validLen.length;if(0<len%4)throw new Error("Invalid string. Length must be a multiple of 4");validLen=validLen.indexOf("=");return[validLen=-1===validLen?len:validLen,validLen===len?0:4-validLen%4]}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],5:[function(require,module,exports){!function(Buffer){!function(){"use strict";var base64=require("base64-js"),ieee754=require("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=function(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;function createBuffer(buf){if(K_MAX_LENGTH<buf)throw new RangeError('The value "'+buf+'" is invalid for option "size"');buf=new Uint8Array(buf);return buf.__proto__=Buffer.prototype,buf}function Buffer(arg,encodingOrOffset,length){if("number"!=typeof arg)return from(arg,encodingOrOffset,length);if("string"==typeof encodingOrOffset)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}function from(value,encodingOrOffset,length){if("string"==typeof value)return function(string,actual){"string"==typeof actual&&""!==actual||(actual="utf8");if(!Buffer.isEncoding(actual))throw new TypeError("Unknown encoding: "+actual);var length=0|byteLength(string,actual),buf=createBuffer(length),actual=buf.write(string,actual);actual!==length&&(buf=buf.slice(0,actual));return buf}(value,encodingOrOffset);if(ArrayBuffer.isView(value))return fromArrayLike(value);if(null==value)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value);if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return function(array,byteOffset,buf){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(buf||0))throw new RangeError('"length" is outside of buffer bounds');buf=void 0===byteOffset&&void 0===buf?new Uint8Array(array):void 0===buf?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,buf);return buf.__proto__=Buffer.prototype,buf}(value,encodingOrOffset,length);if("number"==typeof value)throw new TypeError('The "value" argument must not be of type number. Received type number');var b=value.valueOf&&value.valueOf();if(null!=b&&b!==value)return Buffer.from(b,encodingOrOffset,length);b=function(obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length),buf=createBuffer(len);return 0===buf.length?buf:(obj.copy(buf,0,0,len),buf)}if(void 0!==obj.length)return"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj);if("Buffer"===obj.type&&Array.isArray(obj.data))return fromArrayLike(obj.data)}(value);if(b)return b;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof value[Symbol.toPrimitive])return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be of type number');if(size<0)throw new RangeError('The value "'+size+'" is invalid for option "size"')}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function checked(length){if(K_MAX_LENGTH<=length)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer))return string.byteLength;if("string"!=typeof string)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof string);var len=string.length,mustMatch=2<arguments.length&&!0===arguments[2];if(!mustMatch&&0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((start=void 0===start||start<0?0:start)>this.length)return"";if((end=void 0===end||end>this.length?this.length:end)<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding=encoding||"utf8";;)switch(encoding){case"hex":return function(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0);(!end||end<0||len<end)&&(end=len);for(var out="",i=start;i<end;++i)out+=function(n){return n<16?"0"+n.toString(16):n.toString(16)}(buf[i]);return out}(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return function(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}(this,start,end);case"latin1":case"binary":return function(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}(this,start,end);case"base64":return function(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):2147483647<byteOffset?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),(byteOffset=(byteOffset=numberIsNaN(byteOffset=+byteOffset)?dir?0:buffer.length-1:byteOffset)<0?buffer.length+byteOffset:byteOffset)>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?(dir?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;arrLength/=indexSize=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir)for(var foundIndex=-1,i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(i-(foundIndex=-1===foundIndex?i:foundIndex)+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1;else for(i=byteOffset=arrLength<byteOffset+valLength?arrLength-valLength:byteOffset;0<=i;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function asciiWrite(buf,string,offset,length){return blitBuffer(function(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function(str,units){for(var hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)lo=str.charCodeAt(i),hi=lo>>8,lo=lo%256,byteArray.push(lo),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=239<firstByte?4:223<firstByte?3:191<firstByte?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&127<(tempCodePoint=(31&firstByte)<<6|63&secondByte)&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&2047<(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)&&(tempCodePoint<55296||57343<tempCodePoint)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&65535<(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):65535<codePoint&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}(res)}exports.kMaxLength=K_MAX_LENGTH,(Buffer.TYPED_ARRAY_SUPPORT=function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=from,Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(size,fill,encoding){return assertSize(size),!(size<=0)&&void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)},Buffer.allocUnsafe=allocUnsafe,Buffer.allocUnsafeSlow=allocUnsafe,Buffer.isBuffer=function(b){return null!=b&&!0===b._isBuffer&&b!==Buffer.prototype},Buffer.compare=function(a,b){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(b,Uint8Array)&&(b=Buffer.from(b,b.offset,b.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);if(void 0===length)for(i=length=0;i<list.length;++i)length+=list[i].length;for(var buffer=Buffer.allocUnsafe(length),pos=0,i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)&&(buf=Buffer.from(buf)),!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toLocaleString=Buffer.prototype.toString=function(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES,str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim();return this.length>max&&(str+=" ... "),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)&&(target=Buffer.from(target,target.offset,target.byteLength)),!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof target);if(void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),(start=void 0===start?0:start)<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisEnd<=thisStart&&end<=start)return 0;if(thisEnd<=thisStart)return-1;if(end<=start)return 1;if(this===target)return 0;for(var x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0),len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||remaining<length)&&(length=remaining),0<string.length&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding=encoding||"utf8";for(var loweredCase=!1;;)switch(encoding){case"hex":return function(buf,string,offset,length){offset=Number(offset)||0;var strLen=buf.length-offset;(!length||strLen<(length=Number(length)))&&(length=strLen),(strLen=string.length)/2<length&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}(this,string,offset,length);case"utf8":case"utf-8":return function(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return asciiWrite(this,string,offset,length);case"base64":return function(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(length<offset+ext)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(max<value||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function(start,newBuf){var len=this.length;(start=~~start)<0?(start+=len)<0&&(start=0):len<start&&(start=len),(newBuf=void 0===newBuf?len:~~newBuf)<0?(newBuf+=len)<0&&(newBuf=0):len<newBuf&&(newBuf=len),newBuf<start&&(newBuf=start);newBuf=this.subarray(start,newBuf);return newBuf.__proto__=Buffer.prototype,newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;0<byteLength&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];0<i&&(mul*=256);)val+=this[offset+--i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(val,noAssert){val>>>=0,noAssert||checkOffset(val,2,this.length);val=this[val]|this[val+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(val,noAssert){val>>>=0,noAssert||checkOffset(val,2,this.length);val=this[val+1]|this[val]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,limit){value=+value,offset>>>=0,limit||checkInt(this,value,offset,byteLength,(limit=Math.pow(2,8*byteLength-1))-1,-limit);var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,limit){value=+value,offset>>>=0,limit||checkInt(this,value,offset,byteLength,(limit=Math.pow(2,8*byteLength-1))-1,-limit);var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),this[offset]=255&(value=value<0?255+value+1:value),offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=(value=value<0?4294967295+value+1:value)>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(start=start||0,end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),(end=0<end&&end<start?start:end)===start)return 0;if(0===target.length||0===this.length)return 0;if((targetStart=targetStart||0)<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length);var len=(end=target.length-targetStart<end-start?target.length-targetStart+start:end)-start;if(this===target&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(targetStart,start,end);else if(this===target&&start<targetStart&&targetStart<end)for(var i=len-1;0<=i;--i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var code;1===val.length&&(code=val.charCodeAt(0),("utf8"===encoding&&code<128||"latin1"===encoding)&&(val=code))}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;var i;if(start>>>=0,end=void 0===end?this.length:end>>>0,"number"==typeof(val=val||0))for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function utf8ToBytes(string,units){var codePoint;units=units||1/0;for(var length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if(55295<(codePoint=string.charCodeAt(i))&&codePoint<57344){if(!leadSurrogate){if(56319<codePoint){-1<(units-=3)&&bytes.push(239,191,189);continue}if(i+1===length){-1<(units-=3)&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){-1<(units-=3)&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&-1<(units-=3)&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if(--units<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray(function(str){if((str=(str=str.split("=")[0]).trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isInstance(obj,type){return obj instanceof type||null!=obj&&null!=obj.constructor&&null!=obj.constructor.name&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!=obj}}.call(this)}.call(this,require("buffer").Buffer)},{"base64-js":4,buffer:5,ieee754:25}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")()},{}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.installTimerFunctions=exports.transports=exports.Transport=exports.protocol=exports.Socket=void 0;const socket_js_1=require("./socket.js");Object.defineProperty(exports,"Socket",{enumerable:!0,get:function(){return socket_js_1.Socket}}),exports.protocol=socket_js_1.Socket.protocol;var transport_js_1=require("./transport.js");Object.defineProperty(exports,"Transport",{enumerable:!0,get:function(){return transport_js_1.Transport}});var index_js_1=require("./transports/index.js");Object.defineProperty(exports,"transports",{enumerable:!0,get:function(){return index_js_1.transports}});var util_js_1=require("./util.js");Object.defineProperty(exports,"installTimerFunctions",{enumerable:!0,get:function(){return util_js_1.installTimerFunctions}})},{"./socket.js":8,"./transport.js":9,"./transports/index.js":10,"./util.js":16}],8:[function(require,module,exports){"use strict";var component_emitter_1=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Socket=void 0;const index_js_1=require("./transports/index.js"),util_js_1=require("./util.js"),parseqs_1=component_emitter_1(require("parseqs")),parseuri_1=component_emitter_1(require("parseuri")),debug_1=component_emitter_1(require("debug"));component_emitter_1=require("@socket.io/component-emitter");const engine_io_parser_1=require("engine.io-parser"),debug=(0,debug_1.default)("engine.io-client:socket");class Socket extends component_emitter_1.Emitter{constructor(uri,opts={}){super(),uri&&"object"==typeof uri&&(opts=uri,uri=null),uri?(uri=(0,parseuri_1.default)(uri),opts.hostname=uri.host,opts.secure="https"===uri.protocol||"wss"===uri.protocol,opts.port=uri.port,uri.query&&(opts.query=uri.query)):opts.host&&(opts.hostname=(0,parseuri_1.default)(opts.host).host),(0,util_js_1.installTimerFunctions)(this,opts),this.secure=null!=opts.secure?opts.secure:"undefined"!=typeof location&&"https:"===location.protocol,opts.hostname&&!opts.port&&(opts.port=this.secure?"443":"80"),this.hostname=opts.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=opts.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=opts.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},opts),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=parseqs_1.default.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(name){debug('creating transport "%s"',name);const query=function(obj){const o={};for(var i in obj)obj.hasOwnProperty(i)&&(o[i]=obj[i]);return o}(this.opts.query);query.EIO=engine_io_parser_1.protocol,query.transport=name,this.id&&(query.sid=this.id);var opts=Object.assign({},this.opts.transportOptions[name],this.opts,{query:query,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return debug("options: %j",opts),new index_js_1.transports[name](opts)}open(){let transport;if(this.opts.rememberUpgrade&&Socket.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))transport="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);transport=this.transports[0]}this.readyState="opening";try{transport=this.createTransport(transport)}catch(e){return debug("error while creating transport: %s",e),this.transports.shift(),void this.open()}transport.open(),this.setTransport(transport)}setTransport(transport){debug("setting transport %s",transport.name),this.transport&&(debug("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),(this.transport=transport).on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",()=>{this.onClose("transport close")})}probe(name){debug('probing transport "%s"',name);let transport=this.createTransport(name),failed=!1;Socket.priorWebsocketSuccess=!1;const onTransportOpen=()=>{failed||(debug('probe transport "%s" opened',name),transport.send([{type:"ping",data:"probe"}]),transport.once("packet",msg=>{if(!failed)if("pong"===msg.type&&"probe"===msg.data)debug('probe transport "%s" pong',name),this.upgrading=!0,this.emitReserved("upgrading",transport),transport&&(Socket.priorWebsocketSuccess="websocket"===transport.name,debug('pausing current transport "%s"',this.transport.name),this.transport.pause(()=>{failed||"closed"!==this.readyState&&(debug("changing transport and sending upgrade packet"),cleanup(),this.setTransport(transport),transport.send([{type:"upgrade"}]),this.emitReserved("upgrade",transport),transport=null,this.upgrading=!1,this.flush())}));else{debug('probe transport "%s" failed',name);const err=new Error("probe error");err.transport=transport.name,this.emitReserved("upgradeError",err)}}))};function freezeTransport(){failed||(failed=!0,cleanup(),transport.close(),transport=null)}const onerror=err=>{const error=new Error("probe error: "+err);error.transport=transport.name,freezeTransport(),debug('probe transport "%s" failed because of error: %s',name,err),this.emitReserved("upgradeError",error)};function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){transport&&to.name!==transport.name&&(debug('"%s" works - aborting "%s"',to.name,transport.name),freezeTransport())}const cleanup=()=>{transport.removeListener("open",onTransportOpen),transport.removeListener("error",onerror),transport.removeListener("close",onTransportClose),this.off("close",onclose),this.off("upgrading",onupgrade)};transport.once("open",onTransportOpen),transport.once("error",onerror),transport.once("close",onTransportClose),this.once("close",onclose),this.once("upgrading",onupgrade),transport.open()}onOpen(){if(debug("socket open"),this.readyState="open",Socket.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){debug("starting upgrade probes");let i=0;for(var l=this.upgrades.length;i<l;i++)this.probe(this.upgrades[i])}}onPacket(packet){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(debug('socket receive: type "%s", data "%s"',packet.type,packet.data),this.emitReserved("packet",packet),this.emitReserved("heartbeat"),packet.type){case"open":this.onHandshake(JSON.parse(packet.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const err=new Error("server error");err.code=packet.data,this.onError(err);break;case"message":this.emitReserved("data",packet.data),this.emitReserved("message",packet.data)}else debug('packet received with socket readyState "%s"',this.readyState)}onHandshake(data){this.emitReserved("handshake",data),this.id=data.sid,this.transport.query.sid=data.sid,this.upgrades=this.filterUpgrades(data.upgrades),this.pingInterval=data.pingInterval,this.pingTimeout=data.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),(this.prevBufferLen=0)===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(debug("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}write(msg,options,fn){return this.sendPacket("message",msg,options,fn),this}send(msg,options,fn){return this.sendPacket("message",msg,options,fn),this}sendPacket(type,data,packet,fn){"function"==typeof data&&(fn=data,data=void 0),"function"==typeof packet&&(fn=packet,packet=null),"closing"!==this.readyState&&"closed"!==this.readyState&&((packet=packet||{}).compress=!1!==packet.compress,this.emitReserved("packetCreate",packet={type:type,data:data,options:packet}),this.writeBuffer.push(packet),fn&&this.once("flush",fn),this.flush())}close(){const close=()=>{this.onClose("forced close"),debug("socket closing - telling transport to close"),this.transport.close()},cleanupAndClose=()=>{this.off("upgrade",cleanupAndClose),this.off("upgradeError",cleanupAndClose),close()},waitForUpgrade=()=>{this.once("upgrade",cleanupAndClose),this.once("upgradeError",cleanupAndClose)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{(this.upgrading?waitForUpgrade:close)()}):(this.upgrading?waitForUpgrade:close)()),this}onError(err){debug("socket error %j",err),Socket.priorWebsocketSuccess=!1,this.emitReserved("error",err),this.onClose("transport error",err)}onClose(reason,desc){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(debug('socket close with reason: "%s"',reason),this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",reason,desc),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(upgrades){const filteredUpgrades=[];let i=0;for(var j=upgrades.length;i<j;i++)~this.transports.indexOf(upgrades[i])&&filteredUpgrades.push(upgrades[i]);return filteredUpgrades}}exports.Socket=Socket,Socket.protocol=engine_io_parser_1.protocol},{"./transports/index.js":10,"./util.js":16,"@socket.io/component-emitter":2,debug:17,"engine.io-parser":23,parseqs:26,parseuri:27}],9:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Transport=void 0;const engine_io_parser_1=require("engine.io-parser");var component_emitter_1=require("@socket.io/component-emitter");const util_js_1=require("./util.js"),debug_1=__importDefault(require("debug")),debug=(0,debug_1.default)("engine.io-client:transport");class Transport extends component_emitter_1.Emitter{constructor(opts){super(),(this.writable=!1,util_js_1.installTimerFunctions)(this,opts),this.opts=opts,this.query=opts.query,this.readyState="",this.socket=opts.socket}onError(msg,desc){const err=new Error(msg);return err.type="TransportError",err.description=desc,super.emit("error",err),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(packets){"open"===this.readyState?this.write(packets):debug("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emit("open")}onData(packet){packet=(0,engine_io_parser_1.decodePacket)(packet,this.socket.binaryType);this.onPacket(packet)}onPacket(packet){super.emit("packet",packet)}onClose(){this.readyState="closed",super.emit("close")}}exports.Transport=Transport},{"./util.js":16,"@socket.io/component-emitter":2,debug:17,"engine.io-parser":23}],10:[function(websocket_js_1,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.transports=void 0;var polling_xhr_js_1=websocket_js_1("./polling-xhr.js"),websocket_js_1=websocket_js_1("./websocket.js");exports.transports={websocket:websocket_js_1.WS,polling:polling_xhr_js_1.XHR}},{"./polling-xhr.js":11,"./websocket.js":14}],11:[function(polling_js_1,module,exports){"use strict";var component_emitter_1=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Request=exports.XHR=void 0;const xmlhttprequest_js_1=component_emitter_1(polling_js_1("./xmlhttprequest.js")),debug_1=component_emitter_1(polling_js_1("debug"));var terminationEvent=component_emitter_1(polling_js_1("../globalThis.js"));const util_js_1=polling_js_1("../util.js");component_emitter_1=polling_js_1("@socket.io/component-emitter"),polling_js_1=polling_js_1("./polling.js");const debug=(0,debug_1.default)("engine.io-client:polling-xhr");function empty(){}const hasXHR2=null!=new xmlhttprequest_js_1.default({xdomain:!1}).responseType;class XHR extends polling_js_1.Polling{constructor(forceBase64){if(super(forceBase64),"undefined"!=typeof location){var isSSL="https:"===location.protocol;let port=location.port;port=port||(isSSL?"443":"80"),this.xd="undefined"!=typeof location&&forceBase64.hostname!==location.hostname||port!==forceBase64.port,this.xs=forceBase64.secure!==isSSL}forceBase64=forceBase64&&forceBase64.forceBase64;this.supportsBinary=hasXHR2&&!forceBase64}request(opts={}){return Object.assign(opts,{xd:this.xd,xs:this.xs},this.opts),new Request(this.uri(),opts)}doWrite(data,fn){const req=this.request({method:"POST",data:data});req.on("success",fn),req.on("error",err=>{this.onError("xhr post error",err)})}doPoll(){debug("xhr poll");const req=this.request();req.on("data",this.onData.bind(this)),req.on("error",err=>{this.onError("xhr poll error",err)}),this.pollXhr=req}}exports.XHR=XHR;class Request extends component_emitter_1.Emitter{constructor(uri,opts){super(),(0,util_js_1.installTimerFunctions)(this,opts),this.opts=opts,this.method=opts.method||"GET",this.uri=uri,this.async=!1!==opts.async,this.data=void 0!==opts.data?opts.data:null,this.create()}create(){const opts=(0,util_js_1.pick)(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");opts.xdomain=!!this.opts.xd,opts.xscheme=!!this.opts.xs;const xhr=this.xhr=new xmlhttprequest_js_1.default(opts);try{debug("xhr open %s: %s",this.method,this.uri),xhr.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(var i in xhr.setDisableHeaderCheck&&xhr.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&xhr.setRequestHeader(i,this.opts.extraHeaders[i])}catch(e){}if("POST"===this.method)try{xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{xhr.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in xhr&&(xhr.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(xhr.timeout=this.opts.requestTimeout),xhr.onreadystatechange=()=>{4===xhr.readyState&&(200===xhr.status||1223===xhr.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof xhr.status?xhr.status:0)},0))},debug("xhr data %s",this.data),xhr.send(this.data)}catch(e){return void this.setTimeoutFn(()=>{this.onError(e)},0)}"undefined"!=typeof document&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(data){this.emit("data",data),this.onSuccess()}onError(err){this.emit("error",err),this.cleanup(!0)}cleanup(fromError){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=empty,fromError)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Request.requests[this.index],this.xhr=null}}onLoad(){var data=this.xhr.responseText;null!==data&&this.onData(data)}abort(){this.cleanup()}}function unloadHandler(){for(var i in Request.requests)Request.requests.hasOwnProperty(i)&&Request.requests[i].abort()}exports.Request=Request,Request.requestsCount=0,Request.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",unloadHandler):"function"==typeof addEventListener&&(terminationEvent="onpagehide"in terminationEvent.default?"pagehide":"unload",addEventListener(terminationEvent,unloadHandler,!1)))},{"../globalThis.js":6,"../util.js":16,"./polling.js":12,"./xmlhttprequest.js":15,"@socket.io/component-emitter":2,debug:17}],12:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Polling=void 0;var transport_js_1=require("../transport.js");const debug_1=__importDefault(require("debug")),yeast_1=__importDefault(require("yeast")),parseqs_1=__importDefault(require("parseqs")),engine_io_parser_1=require("engine.io-parser"),debug=(0,debug_1.default)("engine.io-client:polling");class Polling extends transport_js_1.Transport{constructor(){super(...arguments),this.polling=!1}get name(){return"polling"}doOpen(){this.poll()}pause(onPause){this.readyState="pausing";const pause=()=>{debug("paused"),this.readyState="paused",onPause()};if(this.polling||!this.writable){let total=0;this.polling&&(debug("we are currently polling - waiting to pause"),total++,this.once("pollComplete",function(){debug("pre-pause polling complete"),--total||pause()})),this.writable||(debug("we are currently writing - waiting to pause"),total++,this.once("drain",function(){debug("pre-pause writing complete"),--total||pause()}))}else pause()}poll(){debug("polling"),this.polling=!0,this.doPoll(),this.emit("poll")}onData(data){debug("polling got data %s",data);(0,engine_io_parser_1.decodePayload)(data,this.socket.binaryType).forEach(packet=>{if("opening"===this.readyState&&"open"===packet.type&&this.onOpen(),"close"===packet.type)return this.onClose(),!1;this.onPacket(packet)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():debug('ignoring poll - transport state "%s"',this.readyState))}doClose(){var close=()=>{debug("writing close packet"),this.write([{type:"close"}])};"open"===this.readyState?(debug("transport open - closing"),close()):(debug("transport not open - deferring close"),this.once("open",close))}write(packets){(this.writable=!1,engine_io_parser_1.encodePayload)(packets,data=>{this.doWrite(data,()=>{this.writable=!0,this.emit("drain")})})}uri(){let query=this.query||{};var schema=this.opts.secure?"https":"http";let port="";!1!==this.opts.timestampRequests&&(query[this.opts.timestampParam]=(0,yeast_1.default)()),this.supportsBinary||query.sid||(query.b64=1),this.opts.port&&("https"==schema&&443!==Number(this.opts.port)||"http"==schema&&80!==Number(this.opts.port))&&(port=":"+this.opts.port);var encodedQuery=parseqs_1.default.encode(query);return schema+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+port+this.opts.path+(encodedQuery.length?"?"+encodedQuery:"")}}exports.Polling=Polling},{"../transport.js":9,debug:17,"engine.io-parser":23,parseqs:26,yeast:40}],13:[function(globalThis_js_1,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultBinaryType=exports.usingBrowserWebSocket=exports.WebSocket=exports.nextTick=void 0;globalThis_js_1=__importDefault(globalThis_js_1("../globalThis.js"));exports.nextTick="function"==typeof Promise&&"function"==typeof Promise.resolve?cb=>Promise.resolve().then(cb):(cb,setTimeoutFn)=>setTimeoutFn(cb,0),exports.WebSocket=globalThis_js_1.default.WebSocket||globalThis_js_1.default.MozWebSocket,exports.usingBrowserWebSocket=!0,exports.defaultBinaryType="arraybuffer"},{"../globalThis.js":6}],14:[function(require,module,exports){!function(Buffer){!function(){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.WS=void 0;var transport_js_1=require("../transport.js");const parseqs_1=__importDefault(require("parseqs")),yeast_1=__importDefault(require("yeast")),util_js_1=require("../util.js"),websocket_constructor_js_1=require("./websocket-constructor.js"),debug_1=__importDefault(require("debug")),engine_io_parser_1=require("engine.io-parser"),debug=(0,debug_1.default)("engine.io-client:websocket"),isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class WS extends transport_js_1.Transport{constructor(opts){super(opts),this.supportsBinary=!opts.forceBase64}get name(){return"websocket"}doOpen(){if(this.check()){var uri=this.uri(),protocols=this.opts.protocols;const opts=isReactNative?{}:(0,util_js_1.pick)(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(opts.headers=this.opts.extraHeaders);try{this.ws=websocket_constructor_js_1.usingBrowserWebSocket&&!isReactNative?protocols?new websocket_constructor_js_1.WebSocket(uri,protocols):new websocket_constructor_js_1.WebSocket(uri):new websocket_constructor_js_1.WebSocket(uri,protocols,opts)}catch(err){return this.emit("error",err)}this.ws.binaryType=this.socket.binaryType||websocket_constructor_js_1.defaultBinaryType,this.addEventListeners()}}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=ev=>this.onData(ev.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(packets){this.writable=!1;for(let i=0;i<packets.length;i++){const packet=packets[i],lastPacket=i===packets.length-1;(0,engine_io_parser_1.encodePacket)(packet,this.supportsBinary,data=>{const opts={};websocket_constructor_js_1.usingBrowserWebSocket||(packet.options&&(opts.compress=packet.options.compress),this.opts.perMessageDeflate&&("string"==typeof data?Buffer.byteLength(data):data.length)<this.opts.perMessageDeflate.threshold&&(opts.compress=!1));try{websocket_constructor_js_1.usingBrowserWebSocket?this.ws.send(data):this.ws.send(data,opts)}catch(e){debug("websocket closed before onclose event")}lastPacket&&(0,websocket_constructor_js_1.nextTick)(()=>{this.writable=!0,this.emit("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let query=this.query||{};var schema=this.opts.secure?"wss":"ws";let port="";this.opts.port&&("wss"==schema&&443!==Number(this.opts.port)||"ws"==schema&&80!==Number(this.opts.port))&&(port=":"+this.opts.port),this.opts.timestampRequests&&(query[this.opts.timestampParam]=(0,yeast_1.default)()),this.supportsBinary||(query.b64=1);var encodedQuery=parseqs_1.default.encode(query);return schema+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+port+this.opts.path+(encodedQuery.length?"?"+encodedQuery:"")}check(){return!(!websocket_constructor_js_1.WebSocket||"__initialize"in websocket_constructor_js_1.WebSocket&&this.name===WS.prototype.name)}}exports.WS=WS}.call(this)}.call(this,require("buffer").Buffer)},{"../transport.js":9,"../util.js":16,"./websocket-constructor.js":13,buffer:5,debug:17,"engine.io-parser":23,parseqs:26,yeast:40}],15:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const has_cors_1=__importDefault(require("has-cors")),globalThis_js_1=__importDefault(require("../globalThis.js"));exports.default=function(xdomain){xdomain=xdomain.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!xdomain||has_cors_1.default))return new XMLHttpRequest}catch(e){}if(!xdomain)try{return new globalThis_js_1.default[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(e){}}},{"../globalThis.js":6,"has-cors":24}],16:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.installTimerFunctions=exports.pick=void 0;const globalThis_js_1=__importDefault(require("./globalThis.js"));exports.pick=function(obj,...attr){return attr.reduce((acc,k)=>(obj.hasOwnProperty(k)&&(acc[k]=obj[k]),acc),{})};const NATIVE_SET_TIMEOUT=setTimeout,NATIVE_CLEAR_TIMEOUT=clearTimeout;exports.installTimerFunctions=function(obj,opts){opts.useNativeTimers?(obj.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThis_js_1.default),obj.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThis_js_1.default)):(obj.setTimeoutFn=setTimeout.bind(globalThis_js_1.default),obj.clearTimeoutFn=clearTimeout.bind(globalThis_js_1.default))}},{"./globalThis.js":6}],17:[function(require,module,exports){!function(process){!function(){exports.formatArgs=function(args){if(args[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+args[0]+(this.useColors?"%c ":" ")+"+"+module.exports.humanize(this.diff),this.useColors){var c="color: "+this.color;args.splice(1,0,c,"color: inherit");let index=0,lastC=0;args[0].replace(/%[a-zA-Z%]/g,match=>{"%%"!==match&&(index++,"%c"===match&&(lastC=index))}),args.splice(lastC,0,c)}},exports.save=function(namespaces){try{namespaces?exports.storage.setItem("debug",namespaces):exports.storage.removeItem("debug")}catch(error){}},exports.load=function(){let r;try{r=exports.storage.getItem("debug")}catch(error){}!r&&void 0!==process&&"env"in process&&(r=process.env.DEBUG);return r},exports.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},exports.storage=function(){try{return localStorage}catch(error){}}(),exports.destroy=(()=>{let warned=!1;return()=>{warned||(warned=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],exports.log=console.debug||console.log||(()=>{}),module.exports=require("./common")(exports);const formatters=module.exports["formatters"];formatters.j=function(v){try{return JSON.stringify(v)}catch(error){return"[UnexpectedJSONParseError]: "+error.message}}}.call(this)}.call(this,require("_process"))},{"./common":18,_process:28}],18:[function(require,module,exports){module.exports=function(env){function createDebug(namespace){let prevTime,enableOverride=null,namespacesCache,enabledCache;function debug(...args){if(debug.enabled){const self=debug;var curr=Number(new Date),ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr,args[0]=createDebug.coerce(args[0]),"string"!=typeof args[0]&&args.unshift("%O");let index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,(match,val)=>{if("%%"===match)return"%";index++;const formatter=createDebug.formatters[val];return"function"==typeof formatter&&(val=args[index],match=formatter.call(self,val),args.splice(index,1),index--),match}),createDebug.formatArgs.call(self,args);const logFn=self.log||createDebug.log;logFn.apply(self,args)}}return debug.namespace=namespace,debug.useColors=createDebug.useColors(),debug.color=createDebug.selectColor(namespace),debug.extend=extend,debug.destroy=createDebug.destroy,Object.defineProperty(debug,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==enableOverride?enableOverride:(namespacesCache!==createDebug.namespaces&&(namespacesCache=createDebug.namespaces,enabledCache=createDebug.enabled(namespace)),enabledCache),set:v=>{enableOverride=v}}),"function"==typeof createDebug.init&&createDebug.init(debug),debug}function extend(namespace,delimiter){const newDebug=createDebug(this.namespace+(void 0===delimiter?":":delimiter)+namespace);return newDebug.log=this.log,newDebug}function toNamespace(regexp){return regexp.toString().substring(2,regexp.toString().length-2).replace(/\.\*\?$/,"*")}return((createDebug.debug=createDebug).default=createDebug).coerce=function(val){if(val instanceof Error)return val.stack||val.message;return val},createDebug.disable=function(){var namespaces=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map(namespace=>"-"+namespace)].join(",");return createDebug.enable(""),namespaces},createDebug.enable=function(namespaces){createDebug.save(namespaces),createDebug.namespaces=namespaces,createDebug.names=[],createDebug.skips=[];let i;const split=("string"==typeof namespaces?namespaces:"").split(/[\s,]+/),len=split.length;for(i=0;i<len;i++)split[i]&&("-"===(namespaces=split[i].replace(/\*/g,".*?"))[0]?createDebug.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):createDebug.names.push(new RegExp("^"+namespaces+"$")))},createDebug.enabled=function(name){if("*"===name[name.length-1])return!0;let i,len;for(i=0,len=createDebug.skips.length;i<len;i++)if(createDebug.skips[i].test(name))return!1;for(i=0,len=createDebug.names.length;i<len;i++)if(createDebug.names[i].test(name))return!0;return!1},createDebug.humanize=require("ms"),createDebug.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(env).forEach(key=>{createDebug[key]=env[key]}),createDebug.names=[],createDebug.skips=[],createDebug.formatters={},createDebug.selectColor=function(namespace){let hash=0;for(let i=0;i<namespace.length;i++)hash=(hash<<5)-hash+namespace.charCodeAt(i),hash|=0;return createDebug.colors[Math.abs(hash)%createDebug.colors.length]},createDebug.enable(createDebug.load()),createDebug}},{ms:19}],19:[function(require,module,exports){var s=1e3,m=6e4,h=36e5,d=24*h;function plural(ms,isPlural,n,name){isPlural=1.5*n<=isPlural;return Math.round(ms/n)+" "+name+(isPlural?"s":"")}module.exports=function(val,options){options=options||{};var type=typeof val;if("string"==type&&0<val.length)return function(match){if(!(100<(match=String(match)).length)){match=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(match);if(match){var n=parseFloat(match[1]);switch((match[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(val);if("number"==type&&isFinite(val))return(options.long?function(ms){var msAbs=Math.abs(ms);if(d<=msAbs)return plural(ms,msAbs,d,"day");if(h<=msAbs)return plural(ms,msAbs,h,"hour");if(m<=msAbs)return plural(ms,msAbs,m,"minute");if(s<=msAbs)return plural(ms,msAbs,s,"second");return ms+" ms"}:function(ms){var msAbs=Math.abs(ms);if(d<=msAbs)return Math.round(ms/d)+"d";if(h<=msAbs)return Math.round(ms/h)+"h";if(m<=msAbs)return Math.round(ms/m)+"m";if(s<=msAbs)return Math.round(ms/s)+"s";return ms+"ms"})(val);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))}},{}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ERROR_PACKET=exports.PACKET_TYPES_REVERSE=exports.PACKET_TYPES=void 0;const PACKET_TYPES=Object.create(null);exports.PACKET_TYPES=PACKET_TYPES,PACKET_TYPES.open="0",PACKET_TYPES.close="1",PACKET_TYPES.ping="2",PACKET_TYPES.pong="3",PACKET_TYPES.message="4",PACKET_TYPES.upgrade="5",PACKET_TYPES.noop="6";const PACKET_TYPES_REVERSE=Object.create(null);exports.PACKET_TYPES_REVERSE=PACKET_TYPES_REVERSE,Object.keys(PACKET_TYPES).forEach(key=>{PACKET_TYPES_REVERSE[PACKET_TYPES[key]]=key});exports.ERROR_PACKET={type:"error",data:"parser error"}},{}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const commons_js_1=require("./commons.js"),base64_arraybuffer_1=require("@socket.io/base64-arraybuffer"),withNativeArrayBuffer="function"==typeof ArrayBuffer;const mapBinary=(data,binaryType)=>"blob"===binaryType&&data instanceof ArrayBuffer?new Blob([data]):data;exports.default=(encodedPacket,binaryType)=>{if("string"!=typeof encodedPacket)return{type:"message",data:mapBinary(encodedPacket,binaryType)};var type=encodedPacket.charAt(0);return"b"===type?{type:"message",data:((data,binaryType)=>{if(withNativeArrayBuffer){const decoded=(0,base64_arraybuffer_1.decode)(data);return mapBinary(decoded,binaryType)}else return{base64:true,data:data}})(encodedPacket.substring(1),binaryType)}:commons_js_1.PACKET_TYPES_REVERSE[type]?1<encodedPacket.length?{type:commons_js_1.PACKET_TYPES_REVERSE[type],data:encodedPacket.substring(1)}:{type:commons_js_1.PACKET_TYPES_REVERSE[type]}:commons_js_1.ERROR_PACKET}},{"./commons.js":20,"@socket.io/base64-arraybuffer":1}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const commons_js_1=require("./commons.js"),withNativeBlob="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),withNativeArrayBuffer="function"==typeof ArrayBuffer;const encodeBlobAsBase64=(data,callback)=>{const fileReader=new FileReader;return fileReader.onload=function(){var content=fileReader.result.split(",")[1];callback("b"+content)},fileReader.readAsDataURL(data)};exports.default=({type,data},supportsBinary,callback)=>{return withNativeBlob&&data instanceof Blob?supportsBinary?callback(data):encodeBlobAsBase64(data,callback):withNativeArrayBuffer&&(data instanceof ArrayBuffer||(obj=data,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(obj):obj&&obj.buffer instanceof ArrayBuffer))?supportsBinary?callback(data):encodeBlobAsBase64(new Blob([data]),callback):callback(commons_js_1.PACKET_TYPES[type]+(data||""));var obj}},{"./commons.js":20}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.decodePayload=exports.decodePacket=exports.encodePayload=exports.encodePacket=exports.protocol=void 0;const encodePacket_js_1=require("./encodePacket.js");exports.encodePacket=encodePacket_js_1.default;const decodePacket_js_1=require("./decodePacket.js");exports.decodePacket=decodePacket_js_1.default;const SEPARATOR=String.fromCharCode(30);exports.encodePayload=(packets,callback)=>{const length=packets.length,encodedPackets=new Array(length);let count=0;packets.forEach((packet,i)=>{(0,encodePacket_js_1.default)(packet,!1,encodedPacket=>{encodedPackets[i]=encodedPacket,++count===length&&callback(encodedPackets.join(SEPARATOR))})})};exports.decodePayload=(encodedPayload,binaryType)=>{var encodedPackets=encodedPayload.split(SEPARATOR);const packets=[];for(let i=0;i<encodedPackets.length;i++){var decodedPacket=(0,decodePacket_js_1.default)(encodedPackets[i],binaryType);if(packets.push(decodedPacket),"error"===decodedPacket.type)break}return packets},exports.protocol=4},{"./decodePacket.js":21,"./encodePacket.js":22}],24:[function(require,module,exports){try{module.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(err){module.exports=!1}},{}],25:[function(require,module,exports){exports.read=function(buffer,offset,s,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=s?nBytes-1:0,d=s?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;0<nBits;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;0<nBits;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,c,mLen,s){var e,m,eLen=8*s-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=c?0:s-1,d=c?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),2<=(value+=1<=e+eBias?rt/c:rt*Math.pow(2,1-eBias))*c&&(e++,c/=2),eMax<=e+eBias?(m=0,e=eMax):1<=e+eBias?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));8<=mLen;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;0<eLen;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],26:[function(require,module,exports){exports.encode=function(obj){var i,str="";for(i in obj)obj.hasOwnProperty(i)&&(str.length&&(str+="&"),str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i]));return str},exports.decode=function(qs){for(var qry={},pairs=qs.split("&"),i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],27:[function(require,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function(str){var query=str,b=str.indexOf("["),e=str.indexOf("]");-1!=b&&-1!=e&&(str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length));for(var data,m=re.exec(str||""),uri={},i=14;i--;)uri[parts[i]]=m[i]||"";return-1!=b&&-1!=e&&(uri.source=query,uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":"),uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":"),uri.ipv6uri=!0),uri.pathNames=function(path){var names=path.replace(/\/{2,9}/g,"/").split("/");"/"!=path.substr(0,1)&&0!==path.length||names.splice(0,1);"/"==path.substr(path.length-1,1)&&names.splice(names.length-1,1);return names}(uri.path),uri.queryKey=(query=uri.query,data={},query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function($0,$1,$2){$1&&(data[$1]=$2)}),data),uri}},{}],28:[function(require,process,exports){var cachedSetTimeout,cachedClearTimeout,process=process.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],29:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.connect=exports.io=exports.Socket=exports.Manager=exports.protocol=void 0;const url_js_1=require("./url.js"),manager_js_1=require("./manager.js");Object.defineProperty(exports,"Manager",{enumerable:!0,get:function(){return manager_js_1.Manager}});const socket_js_1=require("./socket.js");Object.defineProperty(exports,"Socket",{enumerable:!0,get:function(){return socket_js_1.Socket}});const debug_1=__importDefault(require("debug")),debug=debug_1.default("socket.io-client"),cache={};function lookup(newConnection,opts){"object"==typeof newConnection&&(opts=newConnection,newConnection=void 0),opts=opts||{};var parsed=url_js_1.url(newConnection,opts.path||"/socket.io"),source=parsed.source,id=parsed.id,newConnection=parsed.path,newConnection=cache[id]&&newConnection in cache[id].nsps,newConnection=opts.forceNew||opts["force new connection"]||!1===opts.multiplex||newConnection;let io;return io=newConnection?(debug("ignoring socket cache for %s",source),new manager_js_1.Manager(source,opts)):(cache[id]||(debug("new io instance for %s",source),cache[id]=new manager_js_1.Manager(source,opts)),cache[id]),parsed.query&&!opts.query&&(opts.query=parsed.queryKey),io.socket(parsed.path,opts)}exports.io=lookup,exports.connect=lookup,exports.default=lookup,Object.assign(lookup,{Manager:manager_js_1.Manager,Socket:socket_js_1.Socket,io:lookup,connect:lookup});var socket_io_parser_1=require("socket.io-parser");Object.defineProperty(exports,"protocol",{enumerable:!0,get:function(){return socket_io_parser_1.protocol}}),module.exports=lookup},{"./manager.js":30,"./socket.js":32,"./url.js":33,debug:34,"socket.io-parser":38}],30:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),component_emitter_1=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Manager=void 0;const engine_io_client_1=require("engine.io-client"),socket_js_1=require("./socket.js"),parser=component_emitter_1(require("socket.io-parser")),on_js_1=require("./on.js"),backo2_1=__importDefault(require("backo2"));component_emitter_1=require("@socket.io/component-emitter");const debug_1=__importDefault(require("debug")),debug=debug_1.default("socket.io-client:manager");class Manager extends component_emitter_1.Emitter{constructor(uri,opts){var _a;super(),this.nsps={},this.subs=[],uri&&"object"==typeof uri&&(opts=uri,uri=void 0),(opts=opts||{}).path=opts.path||"/socket.io",this.opts=opts,engine_io_client_1.installTimerFunctions(this,opts),this.reconnection(!1!==opts.reconnection),this.reconnectionAttempts(opts.reconnectionAttempts||1/0),this.reconnectionDelay(opts.reconnectionDelay||1e3),this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(_a=opts.randomizationFactor)&&void 0!==_a?_a:.5),this.backoff=new backo2_1.default({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==opts.timeout?2e4:opts.timeout),this._readyState="closed",this.uri=uri;const _parser=opts.parser||parser;this.encoder=new _parser.Encoder,this.decoder=new _parser.Decoder,this._autoConnect=!1!==opts.autoConnect,this._autoConnect&&this.open()}reconnection(v){return arguments.length?(this._reconnection=!!v,this):this._reconnection}reconnectionAttempts(v){return void 0===v?this._reconnectionAttempts:(this._reconnectionAttempts=v,this)}reconnectionDelay(v){var _a;return void 0===v?this._reconnectionDelay:(this._reconnectionDelay=v,null!==(_a=this.backoff)&&void 0!==_a&&_a.setMin(v),this)}randomizationFactor(v){var _a;return void 0===v?this._randomizationFactor:(this._randomizationFactor=v,null!==(_a=this.backoff)&&void 0!==_a&&_a.setJitter(v),this)}reconnectionDelayMax(v){var _a;return void 0===v?this._reconnectionDelayMax:(this._reconnectionDelayMax=v,null!==(_a=this.backoff)&&void 0!==_a&&_a.setMax(v),this)}timeout(v){return arguments.length?(this._timeout=v,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(fn){if(debug("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;debug("opening %s",this.uri),this.engine=new engine_io_client_1.Socket(this.uri,this.opts);const socket=this.engine,self=this;this._readyState="opening",this.skipReconnect=!1;const openSubDestroy=on_js_1.on(socket,"open",function(){self.onopen(),fn&&fn()});var errorSub=on_js_1.on(socket,"error",err=>{debug("error"),self.cleanup(),self._readyState="closed",this.emitReserved("error",err),fn?fn(err):self.maybeReconnectOnOpen()});if(!1!==this._timeout){const timeout=this._timeout;debug("connect attempt will timeout after %d",timeout),0===timeout&&openSubDestroy();const timer=this.setTimeoutFn(()=>{debug("connect attempt timed out after %d",timeout),openSubDestroy(),socket.close(),socket.emit("error",new Error("timeout"))},timeout);this.opts.autoUnref&&timer.unref(),this.subs.push(function(){clearTimeout(timer)})}return this.subs.push(openSubDestroy),this.subs.push(errorSub),this}connect(fn){return this.open(fn)}onopen(){debug("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");var socket=this.engine;this.subs.push(on_js_1.on(socket,"ping",this.onping.bind(this)),on_js_1.on(socket,"data",this.ondata.bind(this)),on_js_1.on(socket,"error",this.onerror.bind(this)),on_js_1.on(socket,"close",this.onclose.bind(this)),on_js_1.on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(data){this.decoder.add(data)}ondecoded(packet){this.emitReserved("packet",packet)}onerror(err){debug("error",err),this.emitReserved("error",err)}socket(nsp,opts){let socket=this.nsps[nsp];return socket||(socket=new socket_js_1.Socket(this,nsp,opts),this.nsps[nsp]=socket),socket}_destroy(socket){for(const nsp of Object.keys(this.nsps)){const socket=this.nsps[nsp];if(socket.active)return void debug("socket %s is still active, skipping close",nsp)}this._close()}_packet(packet){debug("writing packet %j",packet);var encodedPackets=this.encoder.encode(packet);for(let i=0;i<encodedPackets.length;i++)this.engine.write(encodedPackets[i],packet.options)}cleanup(){debug("cleanup"),this.subs.forEach(subDestroy=>subDestroy()),this.subs.length=0,this.decoder.destroy()}_close(){debug("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(reason){debug("closed due to %s",reason),this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",reason),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const self=this;if(this.backoff.attempts>=this._reconnectionAttempts)debug("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var delay=this.backoff.duration();debug("will wait %dms before reconnect attempt",delay),this._reconnecting=!0;const timer=this.setTimeoutFn(()=>{self.skipReconnect||(debug("attempting reconnect"),this.emitReserved("reconnect_attempt",self.backoff.attempts),self.skipReconnect||self.open(err=>{err?(debug("reconnect attempt error"),self._reconnecting=!1,self.reconnect(),this.emitReserved("reconnect_error",err)):(debug("reconnect success"),self.onreconnect())}))},delay);this.opts.autoUnref&&timer.unref(),this.subs.push(function(){clearTimeout(timer)})}}onreconnect(){var attempt=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",attempt)}}exports.Manager=Manager},{"./on.js":31,"./socket.js":32,"@socket.io/component-emitter":2,backo2:3,debug:34,"engine.io-client":7,"socket.io-parser":38}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.on=void 0,exports.on=function(obj,ev,fn){return obj.on(ev,fn),function(){obj.off(ev,fn)}}},{}],32:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Socket=void 0;const socket_io_parser_1=require("socket.io-parser"),on_js_1=require("./on.js");var component_emitter_1=require("@socket.io/component-emitter");const debug_1=__importDefault(require("debug")),debug=debug_1.default("socket.io-client:socket"),RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Socket extends component_emitter_1.Emitter{constructor(io,nsp,opts){super(),this.connected=!1,this.disconnected=!0,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=io,this.nsp=nsp,opts&&opts.auth&&(this.auth=opts.auth),this.io._autoConnect&&this.open()}subEvents(){var io;this.subs||(io=this.io,this.subs=[on_js_1.on(io,"open",this.onopen.bind(this)),on_js_1.on(io,"packet",this.onpacket.bind(this)),on_js_1.on(io,"error",this.onerror.bind(this)),on_js_1.on(io,"close",this.onclose.bind(this))])}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...args){return args.unshift("message"),this.emit.apply(this,args),this}emit(ev,...ack){if(RESERVED_EVENTS.hasOwnProperty(ev))throw new Error('"'+ev+'" is a reserved event name');ack.unshift(ev);const packet={type:socket_io_parser_1.PacketType.EVENT,data:ack};packet.options={},packet.options.compress=!1!==this.flags.compress,"function"==typeof ack[ack.length-1]&&(isTransportWritable=this.ids++,debug("emitting packet with ack id %d",isTransportWritable),ack=ack.pop(),this._registerAckCallback(isTransportWritable,ack),packet.id=isTransportWritable);var isTransportWritable=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!isTransportWritable||!this.connected)?debug("discard packet as the transport is not currently writable"):this.connected?this.packet(packet):this.sendBuffer.push(packet),this.flags={},this}_registerAckCallback(id,ack){const timeout=this.flags.timeout;if(void 0!==timeout){const timer=this.io.setTimeoutFn(()=>{delete this.acks[id];for(let i=0;i<this.sendBuffer.length;i++)this.sendBuffer[i].id===id&&(debug("removing packet with ack id %d from the buffer",id),this.sendBuffer.splice(i,1));debug("event with ack id %d has timed out after %d ms",id,timeout),ack.call(this,new Error("operation has timed out"))},timeout);this.acks[id]=(...args)=>{this.io.clearTimeoutFn(timer),ack.apply(this,[null,...args])}}else this.acks[id]=ack}packet(packet){packet.nsp=this.nsp,this.io._packet(packet)}onopen(){debug("transport is open - connecting"),"function"==typeof this.auth?this.auth(data=>{this.packet({type:socket_io_parser_1.PacketType.CONNECT,data:data})}):this.packet({type:socket_io_parser_1.PacketType.CONNECT,data:this.auth})}onerror(err){this.connected||this.emitReserved("connect_error",err)}onclose(reason){debug("close (%s)",reason),this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",reason)}onpacket(packet){var id;if(packet.nsp===this.nsp)switch(packet.type){case socket_io_parser_1.PacketType.CONNECT:packet.data&&packet.data.sid?(id=packet.data.sid,this.onconnect(id)):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case socket_io_parser_1.PacketType.EVENT:case socket_io_parser_1.PacketType.BINARY_EVENT:this.onevent(packet);break;case socket_io_parser_1.PacketType.ACK:case socket_io_parser_1.PacketType.BINARY_ACK:this.onack(packet);break;case socket_io_parser_1.PacketType.DISCONNECT:this.ondisconnect();break;case socket_io_parser_1.PacketType.CONNECT_ERROR:this.destroy();const err=new Error(packet.data.message);err.data=packet.data.data,this.emitReserved("connect_error",err)}}onevent(packet){const args=packet.data||[];debug("emitting event %j",args),null!=packet.id&&(debug("attaching ack callback to event"),args.push(this.ack(packet.id))),this.connected?this.emitEvent(args):this.receiveBuffer.push(Object.freeze(args))}emitEvent(args){if(this._anyListeners&&this._anyListeners.length)for(const listener of this._anyListeners.slice())listener.apply(this,args);super.emit.apply(this,args)}ack(id){const self=this;let sent=!1;return function(...args){sent||(sent=!0,debug("sending ack %j",args),self.packet({type:socket_io_parser_1.PacketType.ACK,id:id,data:args}))}}onack(packet){const ack=this.acks[packet.id];"function"==typeof ack?(debug("calling ack %s with %j",packet.id,packet.data),ack.apply(this,packet.data),delete this.acks[packet.id]):debug("bad ack %s",packet.id)}onconnect(id){debug("socket connected with id %s",id),this.id=id,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(args=>this.emitEvent(args)),this.receiveBuffer=[],this.sendBuffer.forEach(packet=>this.packet(packet)),this.sendBuffer=[]}ondisconnect(){debug("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(subDestroy=>subDestroy()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(debug("performing disconnect (%s)",this.nsp),this.packet({type:socket_io_parser_1.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(compress){return this.flags.compress=compress,this}get volatile(){return this.flags.volatile=!0,this}timeout(timeout){return this.flags.timeout=timeout,this}onAny(listener){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(listener),this}prependAny(listener){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(listener),this}offAny(listener){if(!this._anyListeners)return this;if(listener){const listeners=this._anyListeners;for(let i=0;i<listeners.length;i++)if(listener===listeners[i])return listeners.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}exports.Socket=Socket},{"./on.js":31,"@socket.io/component-emitter":2,debug:34,"socket.io-parser":38}],33:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.url=void 0;const parseuri_1=__importDefault(require("parseuri")),debug_1=__importDefault(require("debug")),debug=debug_1.default("socket.io-client:url");exports.url=function(host,path="",loc){let obj=host;return loc=loc||"undefined"!=typeof location&&location,"string"==typeof(host=null==host?loc.protocol+"//"+loc.host:host)&&("/"===host.charAt(0)&&(host="/"===host.charAt(1)?loc.protocol+host:loc.host+host),/^(https?|wss?):\/\//.test(host)||(debug("protocol-less url %s",host),host=void 0!==loc?loc.protocol+"//"+host:"https://"+host),debug("parse %s",host),obj=parseuri_1.default(host)),obj.port||(/^(http|ws)$/.test(obj.protocol)?obj.port="80":/^(http|ws)s$/.test(obj.protocol)&&(obj.port="443")),obj.path=obj.path||"/",host=-1!==obj.host.indexOf(":")?"["+obj.host+"]":obj.host,obj.id=obj.protocol+"://"+host+":"+obj.port+path,obj.href=obj.protocol+"://"+host+(loc&&loc.port===obj.port?"":":"+obj.port),obj}},{debug:34,parseuri:27}],34:[function(require,module,exports){arguments[4][17][0].apply(exports,arguments)},{"./common":35,_process:28,dup:17}],35:[function(require,module,exports){arguments[4][18][0].apply(exports,arguments)},{dup:18,ms:36}],36:[function(require,module,exports){arguments[4][19][0].apply(exports,arguments)},{dup:19}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.reconstructPacket=exports.deconstructPacket=void 0;const is_binary_js_1=require("./is-binary.js");exports.deconstructPacket=function(packet){var buffers=[],packetData=packet.data;const pack=packet;return pack.data=function _deconstructPacket(data,buffers){if(!data)return data;{if(is_binary_js_1.isBinary(data)){const placeholder={_placeholder:!0,num:buffers.length};return buffers.push(data),placeholder}if(Array.isArray(data)){const newData=new Array(data.length);for(let i=0;i<data.length;i++)newData[i]=_deconstructPacket(data[i],buffers);return newData}if("object"==typeof data&&!(data instanceof Date)){const newData={};for(const key in data)data.hasOwnProperty(key)&&(newData[key]=_deconstructPacket(data[key],buffers));return newData}}return data}(packetData,buffers),pack.attachments=buffers.length,{packet:pack,buffers:buffers}},exports.reconstructPacket=function(packet,buffers){return packet.data=function _reconstructPacket(data,buffers){if(!data)return data;{if(data&&data._placeholder)return buffers[data.num];if(Array.isArray(data))for(let i=0;i<data.length;i++)data[i]=_reconstructPacket(data[i],buffers);else if("object"==typeof data)for(const key in data)data.hasOwnProperty(key)&&(data[key]=_reconstructPacket(data[key],buffers))}return data}(packet.data,buffers),packet.attachments=void 0,packet}},{"./is-binary.js":39}],38:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Decoder=exports.Encoder=exports.PacketType=exports.protocol=void 0;var PacketType,component_emitter_1=require("@socket.io/component-emitter");const binary_js_1=require("./binary.js"),is_binary_js_1=require("./is-binary.js"),debug_1=require("debug"),debug=debug_1.default("socket.io-parser");exports.protocol=5,function(PacketType){PacketType[PacketType.CONNECT=0]="CONNECT",PacketType[PacketType.DISCONNECT=1]="DISCONNECT",PacketType[PacketType.EVENT=2]="EVENT",PacketType[PacketType.ACK=3]="ACK",PacketType[PacketType.CONNECT_ERROR=4]="CONNECT_ERROR",PacketType[PacketType.BINARY_EVENT=5]="BINARY_EVENT",PacketType[PacketType.BINARY_ACK=6]="BINARY_ACK"}(PacketType=exports.PacketType||(exports.PacketType={}));exports.Encoder=class{encode(obj){return debug("encoding packet %j",obj),obj.type!==PacketType.EVENT&&obj.type!==PacketType.ACK||!is_binary_js_1.hasBinary(obj)?[this.encodeAsString(obj)]:(obj.type=obj.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK,this.encodeAsBinary(obj))}encodeAsString(obj){let str=""+obj.type;return obj.type!==PacketType.BINARY_EVENT&&obj.type!==PacketType.BINARY_ACK||(str+=obj.attachments+"-"),obj.nsp&&"/"!==obj.nsp&&(str+=obj.nsp+","),null!=obj.id&&(str+=obj.id),null!=obj.data&&(str+=JSON.stringify(obj.data)),debug("encoded %j as %s",obj,str),str}encodeAsBinary(pack){var deconstruction=binary_js_1.deconstructPacket(pack),pack=this.encodeAsString(deconstruction.packet);const buffers=deconstruction.buffers;return buffers.unshift(pack),buffers}};class Decoder extends component_emitter_1.Emitter{constructor(){super()}add(obj){let packet;if("string"==typeof obj)packet=this.decodeString(obj),packet.type===PacketType.BINARY_EVENT||packet.type===PacketType.BINARY_ACK?(this.reconstructor=new BinaryReconstructor(packet),0===packet.attachments&&super.emitReserved("decoded",packet)):super.emitReserved("decoded",packet);else{if(!is_binary_js_1.isBinary(obj)&&!obj.base64)throw new Error("Unknown type: "+obj);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");packet=this.reconstructor.takeBinaryData(obj),packet&&(this.reconstructor=null,super.emitReserved("decoded",packet))}}decodeString(str){let i=0;const p={type:Number(str.charAt(0))};if(void 0===PacketType[p.type])throw new Error("unknown packet type "+p.type);if(p.type===PacketType.BINARY_EVENT||p.type===PacketType.BINARY_ACK){for(var payload=i+1;"-"!==str.charAt(++i)&&i!=str.length;);payload=str.substring(payload,i);if(payload!=Number(payload)||"-"!==str.charAt(i))throw new Error("Illegal attachments");p.attachments=Number(payload)}if("/"===str.charAt(i+1)){const start=i+1;for(;++i;){if(","===str.charAt(i))break;if(i===str.length)break}p.nsp=str.substring(start,i)}else p.nsp="/";payload=str.charAt(i+1);if(""!==payload&&Number(payload)==payload){const start=i+1;for(;++i;){const c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}if(i===str.length)break}p.id=Number(str.substring(start,i+1))}if(str.charAt(++i)){payload=function(str){try{return JSON.parse(str)}catch(e){return!1}}(str.substr(i));if(!Decoder.isPayloadValid(p.type,payload))throw new Error("invalid payload");p.data=payload}return debug("decoded %s as %j",str,p),p}static isPayloadValid(type,payload){switch(type){case PacketType.CONNECT:return"object"==typeof payload;case PacketType.DISCONNECT:return void 0===payload;case PacketType.CONNECT_ERROR:return"string"==typeof payload||"object"==typeof payload;case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(payload)&&0<payload.length;case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(payload)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}exports.Decoder=Decoder;class BinaryReconstructor{constructor(packet){this.packet=packet,this.buffers=[],this.reconPack=packet}takeBinaryData(packet){if(this.buffers.push(packet),this.buffers.length!==this.reconPack.attachments)return null;packet=binary_js_1.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),packet}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}},{"./binary.js":37,"./is-binary.js":39,"@socket.io/component-emitter":2,debug:34}],39:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.hasBinary=exports.isBinary=void 0;const withNativeArrayBuffer="function"==typeof ArrayBuffer,toString=Object.prototype.toString,withNativeBlob="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===toString.call(Blob),withNativeFile="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===toString.call(File);function isBinary(obj){return withNativeArrayBuffer&&(obj instanceof ArrayBuffer||(obj=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(obj):obj.buffer instanceof ArrayBuffer)(obj))||withNativeBlob&&obj instanceof Blob||withNativeFile&&obj instanceof File}exports.isBinary=isBinary,exports.hasBinary=function hasBinary(obj,toJSON){if(!obj||"object"!=typeof obj)return!1;if(Array.isArray(obj)){for(let i=0,l=obj.length;i<l;i++)if(hasBinary(obj[i]))return!0;return!1}if(isBinary(obj))return!0;if(obj.toJSON&&"function"==typeof obj.toJSON&&1===arguments.length)return hasBinary(obj.toJSON(),!0);for(const key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)&&hasBinary(obj[key]))return!0;return!1}},{}],40:[function(require,module,exports){"use strict";var prev,alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={},seed=0,i=0;function encode(num){for(var encoded="";encoded=alphabet[num%length]+encoded,0<(num=Math.floor(num/length)););return encoded}function yeast(){var now=encode(+new Date);return now!==prev?(seed=0,prev=now):now+"."+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode,yeast.decode=function(str){var decoded=0;for(i=0;i<str.length;i++)decoded=decoded*length+map[str.charAt(i)];return decoded},module.exports=yeast},{}],41:[function(require,module,exports){"use strict";function wait(time){return new Promise((resolve,_)=>setTimeout(resolve,time))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseScene=exports.wait=exports._CGame=void 0,exports.wait=wait;exports._CGame=class{_startingScene;ctx;fps;width;height;static detectMobile(){const a=navigator.userAgent||navigator.vendor||window.opera;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))}getMousePos(event){var y=this.ctx.canvas.getBoundingClientRect(),x=(event.clientX-y.left)*(this.ctx.canvas.width/y.width),y=(event.clientY-y.top)*(this.ctx.canvas.height/y.height);if(!(x<0||x>this.ctx.canvas.width||y<0||y>this.ctx.canvas.height))return{x:x,y:y}}eventQueue;pressedKeys;alreadyFired;mouse;constructor(_startingScene,ctx,fps,width,resizeWindow){this._startingScene=_startingScene,this.ctx=ctx,this.fps=fps,this.width=width,this.height=resizeWindow,this.mouse={x:0,y:0},ctx.canvas.width=width,ctx.canvas.height=resizeWindow;resizeWindow=()=>{var scale=Math.min(innerWidth/this.width,innerHeight/this.height);ctx.canvas.style.width=this.width*scale+"px",ctx.canvas.style.height=this.height*scale+"px"};resizeWindow(),window.onresize=resizeWindow,this.eventQueue=[],this.pressedKeys=new Map,this.alreadyFired=new Map,document.onkeydown=event=>{this.alreadyFired.get(event.code)||(this.alreadyFired.set(event.code,!0),this.pressedKeys.set(event.code,!0),this.eventQueue.push({eventType:"KeyDown",key:event.key,code:event.code,raw:event}))},document.onkeyup=event=>{this.alreadyFired.set(event.code,!1),this.pressedKeys.set(event.code,!1),this.eventQueue.push({eventType:"KeyUp",key:event.key,code:event.code,raw:event})},document.onmousemove=event=>{this.getMousePos(event)&&(this.mouse=this.getMousePos(event),this.eventQueue.push({eventType:"MouseMove",raw:event}))},document.onmousedown=event=>{this.getMousePos(event)&&(this.pressedKeys.set(0===event.button?"MouseLeft":1===event.button?"MouseMiddle":2===event.button?"MouseRight":"MouseUnknown",!0),this.eventQueue.push({eventType:"MouseDown",raw:event}))},document.onmouseup=event=>{this.getMousePos(event)&&(this.pressedKeys.set(0===event.button?"MouseLeft":1===event.button?"MouseMiddle":2===event.button?"MouseRight":"MouseUnknown",!1),this.eventQueue.push({eventType:"MouseUp",raw:event}))}}async run(){this.ctx.imageSmoothingEnabled=!1;let timeLastFrame=t=performance.now(),scene=new this._startingScene(this);for(;null!==scene;){var t,deltaTime=(t=performance.now())-timeLastFrame;timeLastFrame=t;var events=this.eventQueue;this.eventQueue=[],scene.processInput(events,this.pressedKeys,deltaTime),scene.update(deltaTime),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),scene.draw(),scene=scene.next,await wait(1e3/this.fps)}}applyFillOptions(fillOptions){this.ctx.fillStyle=fillOptions?.style?fillOptions.style:"#000000",this.ctx.shadowBlur=fillOptions?.shadowBlur?fillOptions.shadowBlur:0,this.ctx.shadowColor=fillOptions?.shadowColor?fillOptions.shadowColor:"#000000",this.ctx.shadowOffsetX=fillOptions?.shadowOffset?.x?fillOptions.shadowOffset.x:0,this.ctx.shadowOffsetY=fillOptions?.shadowOffset?.y?fillOptions.shadowOffset.y:0}drawRect(rect){this.applyFillOptions(rect.style),this.ctx.fillRect(Math.round(rect.topLeft.x),Math.round(rect.topLeft.y),Math.round(rect.width),Math.round(rect.height))}};exports.BaseScene=class{CGame;next;mouse;constructor(CGame){this.CGame=CGame,(this.next=this).mouse={x:0,y:0}}switchToScene(nextScene){this.next=nextScene}terminateGame(){this.next}processInput(events,pressedKeys,dt){throw new Error("processInput wasn't overridden")}update(dt){throw new Error("update wasn't overridden")}draw(){throw new Error("draw wasn't overridden")}}},{}],42:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Rect=void 0;exports.Rect=class Rect{center;width;height;style;get top(){return this.center.y-this.height/2}set top(top){this.center.y=top+this.height/2}get bottom(){return this.center.y+this.height/2}set bottom(bottom){this.center.y=bottom-this.height/2}get left(){return this.center.x-this.width/2}set left(left){this.center.x=left+this.width/2}get right(){return this.center.x+this.width/2}set right(right){this.center.x=right-this.width/2}get topLeft(){return{x:this.center.x-this.width/2,y:this.center.y-this.height/2}}get bottomRight(){return{x:this.center.x+this.width/2,y:this.center.y+this.height/2}}constructor(center,width,height,style){this.center=center,this.width=width,this.height=height,this.style=style,this.center=center}static topLeftConstructor(topLeft,width,height,style){return new Rect({x:topLeft.x+width/2,y:topLeft.y+height/2},width,height,style)}static bottomRightConstructor(bottomRight,width,height,style){return new Rect({x:bottomRight.x-width/2,y:bottomRight.y-height/2},width,height,style)}static contains(a,b){return!(b.topLeft.x<a.topLeft.x||b.topLeft.y<a.topLeft.y||b.topLeft.x+b.width>a.topLeft.x+a.width||b.topLeft.y+b.height>a.topLeft.y+a.height)}static touches(a,b){return!(a.topLeft.x>b.topLeft.x+b.width||b.topLeft.x>a.topLeft.x+a.width||a.topLeft.y>b.topLeft.y+b.height||b.topLeft.y>a.topLeft.y+a.height)}}},{}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Client=void 0;const socket_io_client_1=require("socket.io-client"),otherPlayer_1=require("./otherPlayer");exports.Client=class{game;io;constructor(game){this.game=game,this.io=(0,socket_io_client_1.io)("http://localhost:3000"),this.io.on("playerJoin",username=>{game.otherPlayers[username]=new otherPlayer_1.OtherPlayer(game,game.spawnLocation)}),this.io.on("playerLeave",username=>{delete game.otherPlayers[username]}),this.io.on("updatePositions",positions=>{for(const username in positions)username!==game.username&&(game.otherPlayers[username]||(game.otherPlayers[username]=new otherPlayer_1.OtherPlayer(game,game.spawnLocation)),game.otherPlayers[username].image.center=positions[username].location)})}setUsername(){const username=prompt("username?");this.io.emit("setUsername",username,valid=>{valid&&(this.game.username=username)})}createGame(){this.io.emit("create",(error,id)=>{error||(this.game.gameId=id)})}update(location){this.io.emit("move",location)}join(id){this.io.emit("join",id,(error,positions)=>{if(console.log(id,error,positions),error){this.game.gameId=id;for(const username in positions)username!==this.game.username&&(this.game.otherPlayers[username]||(this.game.otherPlayers[username]=new otherPlayer_1.OtherPlayer(this.game,this.game.spawnLocation)),this.game.otherPlayers[username].image.center=positions[username].location)}})}}},{"./otherPlayer":45,"socket.io-client":29}],44:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GameScene=void 0;var framework_1=require("../../../framework/framework");const rect_1=require("../../../framework/shapes/rect"),client_1=require("./client"),player_1=require("./player"),wall_1=require("./wall");class GameScene extends framework_1.BaseScene{player;otherPlayers;walls;client;username;gameId;spawnLocation;constructor(CGame){super(CGame),this.client=new client_1.Client(this),this.spawnLocation={x:this.CGame.ctx.canvas.width/2,y:0},this.player=new player_1.Player(this),this.walls=[new wall_1.Wall(this,{x:this.CGame.width/2,y:this.CGame.height-100},100,50),new wall_1.Wall(this,{x:this.CGame.width/2-100,y:this.CGame.height-150},50,100)],this.otherPlayers={}}processInput(events,pressedKeys,dt){this.player.processInput(events,pressedKeys,dt),events.forEach(event=>{if("KeyDown"===event.eventType)switch(event.code){case"KeyJ":this.client.setUsername();break;case"KeyK":this.client.join(prompt("server"));break;case"KeyL":this.client.createGame()}})}update(dt){this.player.update(dt),this.walls.forEach(wall=>wall.update())}draw(){this.CGame.drawRect(rect_1.Rect.topLeftConstructor({x:0,y:0},this.CGame.width,this.CGame.height,{style:"#f5f5f5"})),this.player.draw(),Object.values(this.otherPlayers).forEach(otherPlayer=>otherPlayer.draw()),this.walls.forEach(wall=>wall.draw())}}exports.GameScene=GameScene},{"../../../framework/framework":41,"../../../framework/shapes/rect":42,"./client":43,"./player":46,"./wall":47}],45:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.OtherPlayer=void 0;const rect_1=require("../../../framework/shapes/rect");exports.OtherPlayer=class{game;image;constructor(game,location){this.game=game,this.image=new rect_1.Rect(location,25,25,{style:"#00FF00",shadowBlur:5,shadowColor:"#000000"})}draw(){this.game.CGame.drawRect(this.image)}}},{"../../../framework/shapes/rect":42}],46:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Player=void 0;const rect_1=require("../../../framework/shapes/rect");exports.Player=class{game;hitbox;image;hspd;vspd;speed;_touchingGroundRect;touchingGround;gravitySpeed;_gravityAcceleration;_gravityTopSpeed;jumping;_jumpSpeed;_jumpDuration;_jumpedWhen;constructor(game){this.game=game,this.hspd=0,this.vspd=0,this.hitbox=new rect_1.Rect(game.spawnLocation,25,25),this.image=new rect_1.Rect(this.hitbox.center,this.hitbox.width,this.hitbox.height,{style:"#FF0000",shadowBlur:5,shadowColor:"#000000"}),this._touchingGroundRect=new rect_1.Rect({x:this.hitbox.center.x,y:this.hitbox.topLeft.y+this.hitbox.height+2.5},this.hitbox.width,5),this.speed=.5,this.touchingGround=!1,this.gravitySpeed=0,this._gravityAcceleration=.05,this._gravityTopSpeed=100,this.jumping=!1,this._jumpSpeed=1.2,this._jumpDuration=100,this._jumpedWhen=0}processInput(events,pressedKeys,dt){this.image.center=this.hitbox.center,this._touchingGroundRect.center={x:this.hitbox.center.x,y:this.hitbox.topLeft.y+this.hitbox.height+2.5},this.vspd=0,this.hspd=0,pressedKeys.get("KeyA")&&(this.hspd-=this.speed*dt),pressedKeys.get("KeyD")&&(this.hspd+=this.speed*dt),this.touchingGround=!1;for(const wall of this.game.walls)if(rect_1.Rect.touches(wall.hitbox,this._touchingGroundRect)){this.touchingGround=!0;break}0<events.filter(event=>"KeyDown"===event.eventType&&"Space"===event.code).length&&this.touchingGround&&(this.jumping=!0,this._jumpedWhen=performance.now()),this.jumping&&(console.log("jumping"),this.vspd-=this._jumpSpeed*dt,performance.now()>=this._jumpedWhen+this._jumpDuration&&(this.jumping=!1))}update(dt){this.touchingGround||this.jumping?this.gravitySpeed=0:(this.gravitySpeed=Math.min(this._gravityTopSpeed,this.gravitySpeed+this._gravityAcceleration*dt),this.vspd+=this.gravitySpeed);var vFutureHitbox=new rect_1.Rect({...this.hitbox.center,y:this.hitbox.center.y+this.vspd},this.hitbox.width,this.hitbox.height),hFutureHitbox=new rect_1.Rect({...this.hitbox.center,x:this.hitbox.center.x+this.hspd},this.hitbox.width,this.hitbox.height);let hTouches=!1,vTouches=!1;for(const wall of this.game.walls)rect_1.Rect.touches(wall.hitbox,vFutureHitbox)&&(0<this.vspd?(console.log("Bottom"),this.hitbox.bottom=wall.hitbox.top-2.5):(console.log("Top"),this.hitbox.top=wall.hitbox.bottom+2.5),vTouches=!0),rect_1.Rect.touches(wall.hitbox,hFutureHitbox)&&(0<this.hspd?this.hitbox.right=wall.hitbox.left-2.5:this.hitbox.left=wall.hitbox.right+2.5,hTouches=!0);hTouches||(this.hitbox.center.x+=this.hspd),vTouches||(this.hitbox.center.y+=this.vspd),this.game.client.update(this.hitbox.center)}draw(){this.game.CGame.drawRect(this.image)}}},{"../../../framework/shapes/rect":42}],47:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Wall=void 0;const rect_1=require("../../../framework/shapes/rect");exports.Wall=class{game;location;width;height;hitbox;image;constructor(game,location,width,height){this.game=game,this.location=location,this.width=width,this.height=height,this.hitbox=new rect_1.Rect(location,width,height),this.image=new rect_1.Rect(location,width,height,{style:"#00FFFF",shadowBlur:5,shadowColor:"#000000"})}update(){this.image.center=this.hitbox.center}draw(){this.game.CGame.drawRect(this.image)}}},{"../../../framework/shapes/rect":42}],48:[function(game_1,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const framework_1=game_1("./framework/framework");game_1=game_1("./game/scenes/game/game");const canvas=document.getElementById("game");if(!canvas)throw new Error('Canvas "game" not found!');const CGame=new framework_1._CGame(game_1.GameScene,canvas.getContext("2d"),60,1280,720);CGame.run()},{"./framework/framework":41,"./game/scenes/game/game":44}]},{},[48]);
